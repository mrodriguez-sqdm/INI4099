<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="get-coverageGIS-orchestratorSub_Flow" doc:id="af4bc436-183a-4ad8-abdd-6388e44334fd" >
		<parse-template doc:name="Parse Template Xml" doc:id="ee02ac0e-f23c-4d30-9d7c-4c1bc0734b57" location="soap\schemas\templates\coverageGIS.xml"/>
		<flow-ref doc:name="Go to Client" doc:id="4838cd3d-37c3-4904-9393-8dbc2881ed90" name="get-coverageGIS-clientSub_Flow"/>
		<ee:transform doc:name="System Output" doc:id="5064e202-b462-4e45-9280-3db763a4e8b8" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
var Tecnologia = payload.Envelope.Body."wsGetFactibilidadServicios-RS".Tecnologias.*Tecnologia
---
if(vars.errorDesc != null) vars.errorDesc
else
{
  "wsGetFactibilidadServicios-RS":{
    "CodigoIntegracion": payload.Envelope.Body.'wsGetFactibilidadServicios-RS'.CodigoIntegracion,
    "Tecnologias": {
      "Tecnologia": Tecnologia map {
                "Tipo": $.Tipo,
                "Propietario": $.Propietario,
                "EstratoPredominante": $.EstratoPredominante,
                "TipoCobertura": $.TipoCobertura,
                "Cobertura": $.Cobertura,
                "NombreCobertura": $.NombreCobertura,
                "TipoArea": $.TipoArea,
                "Area": if(upper($.Area) == "SANTA INES") "SANTA_INES" else (upper($.Area)),
                "MigracionOLT": $.MigracionOLT,
                "NombreOLT": $.NombreOLT
                }
    },
    "GisRespuestaProceso":{
     "CodigoRespuesta": payload.Envelope.Body."wsGetFactibilidadServicios-RS".GisRespuestaProceso.CodigoRespuesta,
     "FechaRespuesta": {
       "date": payload.Envelope.Body."wsGetFactibilidadServicios-RS".GisRespuestaProceso.FechaRespuesta.date
     },
     "CodigoError": payload.Envelope.Body."wsGetFactibilidadServicios-RS".GisRespuestaProceso.CodigoError,
     "DescripcionError": payload.Envelope.Body."wsGetFactibilidadServicios-RS".GisRespuestaProceso.DescripcionError
    }
  }
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="Check System Output" doc:id="0622ab49-fee7-449f-a9d6-d8e22acf81ab" message="#[payload]"/>
	</sub-flow>
</mule>
