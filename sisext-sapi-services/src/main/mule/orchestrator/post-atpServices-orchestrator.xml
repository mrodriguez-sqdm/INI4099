<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:os="http://www.mulesoft.org/schema/mule/os" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/os http://www.mulesoft.org/schema/mule/os/current/mule-os.xsd">
	<sub-flow name="post-atpServices-token-and-atp-client" doc:id="2638255e-8224-480c-a65b-80f637be102b">
		<choice doc:name="Choice" doc:id="16f73eea-b8ad-4960-811c-460e14e3ac8a">
					<when expression="#[vars.validation_result.isValid]">
						<flow-ref doc:name="Go to get token" doc:id="ee433dfe-58c3-4642-afd6-f365be40e288" name="post-get-token-resetValidate" target="token" />
						<try doc:name="Try" doc:id="37b8f278-a89e-4830-8aed-f355d25aa726">
					<flow-ref doc:name="Go to client" doc:id="3e95422a-bcd3-4eae-a836-67f565b5641d" name="#[vars.flowNameClient]" />
					<choice doc:name="Choice" doc:id="be1ea439-b3de-485a-8ab0-8f4e92a07606">
						<when expression='#[payload.code == "47"]'>
							<raise-error doc:name="Raise error" doc:id="109fdec7-5823-47aa-9ffe-a9ef8d6e50be" type="CUSTOM:TOKEN_EXPIRED" />
						</when>
					</choice>
					<error-handler>
				<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="a4b4e7d6-8a72-4c4a-823a-bd72fa0f004a" type="CUSTOM:TOKEN_EXPIRED">
					<ee:transform doc:name="Set reset" doc:id="500fc263-25ae-4480-81a5-d81278987bb9">
						<ee:message>
						</ee:message>
						<ee:variables>
							<ee:set-variable variableName="reset"><![CDATA[%dw 2.0
output application/java
---
"true"]]></ee:set-variable>
						</ee:variables>
					</ee:transform>
					<flow-ref doc:name="Go to get token" doc:id="f04d3387-c3fb-4930-9169-eaad17ed91b4" name="post-get-token-resetValidate" target="token" />
							<ee:transform doc:name="Set request body" doc:id="b4de2269-bcbe-44e9-91d2-182346b39cd9">
								<ee:message>
									<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
vars.inputPayload]]></ee:set-payload>
								</ee:message>
							</ee:transform>
							<flow-ref doc:name="Go to client" doc:id="db615c7a-41c9-4e63-bd04-e5b6e1cf1c5d" name="#[vars.flowNameClient]" />
				</on-error-continue>
			</error-handler>
		</try>
				<ee:transform doc:name="Set response" doc:id="8595ffb4-776a-47b1-9c32-90249a16fce6">
					<ee:message>
						<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
if(payload.code != null) {
    "status": 500,
    "code": payload.code default "ATP_ERROR",
  	"messageServer": payload.reason default "ATP error",
    "message": {
        "message": payload.reason default "ATP error"
    },
    "cause": [
        {
            "origin": "sisext-sapi-services",
            "message": "org.mule.extension.http.api.request.validator.ResponseValidatorException"
        }
    ]
} else payload]]></ee:set-payload>
					</ee:message>
					<ee:variables>
						<ee:set-variable variableName="httpStatus"><![CDATA[%dw 2.0
output application/java
---
if(payload.code != null) 500 else 200]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
					</when>
					<otherwise>
						<ee:transform doc:name="Error" doc:id="13e12b3c-9a9a-4d28-b395-224383572240">
							<ee:message>
								<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{
    "status": 400,
    "code": "BAD_REQUEST",
  	"messageServer": "Bad request",
    "message": {
        "message": vars.validation_result.error default "bad request error"
    },
    "cause": [
        {
            "origin": "sisext-sapi-services",
            "message": "org.mule.extension.http.api.request.validator.ResponseValidatorException"
        }
    ]
}]]></ee:set-payload>
							</ee:message>
					<ee:variables>
						<ee:set-variable variableName="httpStatus"><![CDATA[%dw 2.0
output application/java
---
400]]></ee:set-variable>
					</ee:variables>
						</ee:transform>
					</otherwise>
				</choice>
	</sub-flow>
	<sub-flow name="post-atpServices-bookingFeasibility" doc:id="eb8f3359-f9ce-43ec-b3b6-0a51b5ad3faa">
		<choice doc:name="Choice" doc:id="6a889740-a977-4560-a56f-8e0e68c80489">
			<when expression="#[(p('atp.muleValidation') splitBy &quot;|&quot; filter $ == &quot;bookingFeasibility&quot;) != []]" >
				<ee:transform doc:name="Validate check body" doc:id="26a623c3-e3df-471f-a1f9-7dcbf29efa7e">
			<ee:message />
			<ee:variables>
				<ee:set-variable variableName="validation_result"><![CDATA[%dw 2.0
output application/java
---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
			</when>
			<otherwise >
				<ee:transform doc:name="Validate = true" doc:id="d45609ff-0827-404b-871e-1f25a9f4cdad" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java
---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</otherwise>
		</choice>
		<ee:transform doc:name="Set flowNameClient" doc:id="fe2e73dc-7cc7-44f1-a8fc-fa90a54007bf">
			<ee:message />
			<ee:variables>
				<ee:set-variable variableName="flowNameClient"><![CDATA[%dw 2.0
output application/java
---
p('atp.flow.bookingFeasibility')]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<flow-ref doc:name="Go to token and atp client" doc:id="cc4ff28f-87a7-407b-b1ff-d5a29dbc6415" name="post-atpServices-token-and-atp-client" />
	</sub-flow>
	<sub-flow name="post-atpServices-createBooking" doc:id="76f6bd08-2372-4adf-b728-8d69022c42c2">
		<choice doc:name="Choice" doc:id="d73a7063-e1cb-4f55-a85c-071c7bd7c676">
			<when expression="#[(p('atp.muleValidation') splitBy &quot;|&quot; filter $ == &quot;createBooking&quot;) != []]" >
				<ee:transform doc:name="Validate add body" doc:id="b3395028-45c7-4d86-8f1b-e542a74d7498">
					<ee:message>
					</ee:message>
					<ee:variables>
						<ee:set-variable variableName="validation_result"><![CDATA[%dw 2.0
output application/java
---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</when>
			<otherwise >
				<ee:transform doc:name="Validate = true" doc:id="89b69bc1-5389-47b0-9055-e2f914d9f520" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java
---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</otherwise>
		</choice>
		<choice doc:name="Choice" doc:id="15a72499-66f9-4380-b03c-1a33fc4da0fe" >
			<when expression="#[payload.serviceQualificationItem[0].expirationDate == null]">
				<ee:transform doc:name="Set expiration date" doc:id="e98f8c0a-41f8-40a2-9bec-bc83f2857e3d">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
import * from dw::core::Periods
output application/json
---
payload - "serviceQualificationItem" ++
{
  serviceQualificationItem: payload.serviceQualificationItem map ((item, index) ->  
  {
    expirationDate: ((now() + days(p('atp.days') as Number)) >> "GMT")
  } ++ (item - "expirationDate")
  )
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
			</when>
		</choice>
		<ee:transform doc:name="Set flowNameClient" doc:id="0a7fcb48-ff8c-4ad5-9e17-6b3127e48d12">
					<ee:message>
					</ee:message>
					<ee:variables>
						<ee:set-variable variableName="flowNameClient"><![CDATA[%dw 2.0
output application/java
---
p('atp.flow.createBooking')]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
		<flow-ref doc:name="Go to token and atp client" doc:id="b99a2cb6-5090-4b0e-a2d5-ea8164ed454e" name="post-atpServices-token-and-atp-client"/>
	</sub-flow>
	<sub-flow name="post-atpServices-consultBooking" doc:id="f6a66eb8-b451-4380-aa4e-8bae5912a7bf">
		<choice doc:name="Choice" doc:id="a69fbfd3-10fd-470e-8909-704fb0f401d0">
			<when expression="#[(p('atp.muleValidation') splitBy &quot;|&quot; filter $ == &quot;consultBooking&quot;) != []]" >
				<ee:transform doc:name="Validate query body" doc:id="481fe8ae-e6ec-496f-ac9e-23e4fdee159d">
					<ee:message />
					<ee:variables>
						<ee:set-variable variableName="validation_result"><![CDATA[%dw 2.0
output application/java
---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</when>
			<otherwise >
				<ee:transform doc:name="Validate = true" doc:id="b46f1ded-4add-4ff9-89f6-663ba1dbf509" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java
---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</otherwise>
		</choice>
		<ee:transform doc:name="Set flowNameClient" doc:id="804334d0-7192-4978-9008-97f55db81650">
			<ee:message />
			<ee:variables>
				<ee:set-variable variableName="flowNameClient"><![CDATA[%dw 2.0
output application/java
---
p('atp.flow.consultBooking')]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<flow-ref doc:name="Go to token and atp client" doc:id="c0de3968-a812-48d5-8369-26f8718602d5" name="post-atpServices-token-and-atp-client" />
	</sub-flow>
	<sub-flow name="post-atpServices-cancelBooking" doc:id="cc4e78b3-4c74-4875-9f43-09072a75a3a5">
		<choice doc:name="Choice" doc:id="7e286b8b-88f0-433a-8ffc-625d74899199">
			<when expression="#[(p('atp.muleValidation') splitBy &quot;|&quot; filter $ == &quot;cancelBooking&quot;) != []]" >
				<ee:transform doc:name="Validate delete body" doc:id="bff97cf6-f1a6-4624-85bb-f4828f8dce22">
					<ee:message />
					<ee:variables>
						<ee:set-variable variableName="validation_result"><![CDATA[%dw 2.0
output application/java
---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</when>
			<otherwise >
				<ee:transform doc:name="Validate = true" doc:id="1ef1bda9-43c4-4285-91f5-6df923c67fee" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java
---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</otherwise>
		</choice>
		<ee:transform doc:name="Set flowNameClient" doc:id="972067e2-b182-4be6-96da-e8b6ded58d4d">
			<ee:message />
			<ee:variables>
				<ee:set-variable variableName="flowNameClient"><![CDATA[%dw 2.0
output application/java
---
p('atp.flow.cancelBooking')]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<flow-ref doc:name="Go to token and atp client" doc:id="7083b373-a0d9-497c-832e-c99560776a7f" name="post-atpServices-token-and-atp-client" />
	</sub-flow>
	<sub-flow name="post-atpServices-activateOnt" doc:id="d1e5327b-4605-4b7e-b1e2-dc9f38660685" >
		<choice doc:name="Choice" doc:id="7d853d1f-4f5b-4949-bfb3-4d0a0ca010f8">
			<when expression="#[(p('atp.muleValidation') splitBy &quot;|&quot; filter $ == &quot;activateOnt&quot;) != []]" >
				<ee:transform doc:name="Validate addOnt body" doc:id="81b691d4-2bf7-478b-a7e2-532e7a17a37b">
					<ee:message />
					<ee:variables>
						<ee:set-variable variableName="validation_result"><![CDATA[%dw 2.0
output application/java

var ONT = sizeOf((payload.feature filter $.name == "ont")  default []) != 0
var reservation = sizeOf((payload.feature filter $.name == "reservation")  default []) != 0
var serialNumber = sizeOf((((payload.feature filter $.name == "ont")  default [])[0].featureCharacteristic filter $.name == "serialNumber") default []) != 0
var model = sizeOf((((payload.feature filter $.name == "ont")  default [])[0].featureCharacteristic filter $.name == "model") default []) != 0
var id = sizeOf((((payload.feature filter $.name == "reservation")  default [])[0].featureCharacteristic filter $.name == "id") default []) != 0
---
{
  isValid: ONT and reservation and serialNumber and model and id,
  error: if(!ONT) "ONT must not be empty" else
          if(!reservation) "reservation must not be empty" else
          if(!serialNumber) "serialNumber must not be empty" else
          if(!model) "model must not be empty" else
          if(!id) "id must not be empty" else
          null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</when>
			<otherwise >
				<ee:transform doc:name="Validate = true" doc:id="6b78e5cf-4264-4ea0-b5e5-cd0d1a28aa75" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java
---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</otherwise>
		</choice>
		<ee:transform doc:name="Set flowNameClient" doc:id="9458362b-0484-452d-a0c6-364b86490816">
					<ee:message />
					<ee:variables>
						<ee:set-variable variableName="flowNameClient"><![CDATA[%dw 2.0
output application/java
---
p('atp.flow.activateOnt')]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
		<flow-ref doc:name="Go to token and atp client" doc:id="73f89f3f-cbb6-4bfe-9aa9-58a61b061fd0" name="post-atpServices-token-and-atp-client" />
	</sub-flow>
	<sub-flow name="post-atpServices-activateService" doc:id="2ac4423e-f09f-46c5-b40e-6ad916b30fe6" >
		<choice doc:name="Choice" doc:id="31694f34-8a01-4e82-aed0-16ee27f0bb80">
			<when expression="#[(p('atp.muleValidation') splitBy &quot;|&quot; filter $ == &quot;activateService&quot;) != []]" >
				<ee:transform doc:name="Validate addService body" doc:id="a0563693-3e31-4cd3-a61b-43bd1e8943ac">
					<ee:message />
					<ee:variables>
						<ee:set-variable variableName="validation_result"><![CDATA[%dw 2.0
output application/java

var reservation = sizeOf((payload.feature filter $.name == "reservation")  default []) != 0
var id = sizeOf((((payload.feature filter $.name == "reservation")  default [])[0].featureCharacteristic filter $.name == "id") default []) != 0
---
{
  isValid: reservation and id,
  error: if(!reservation) "reservation must not be empty" else
          if(!id) "id must not be empty" else
          null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</when>
			<otherwise >
				<ee:transform doc:name="Validate = true" doc:id="56194baa-f0b3-4b26-8afb-7787b824ed1d" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java
---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</otherwise>
		</choice>
		<ee:transform doc:name="Set flowNameClient" doc:id="21711b16-8f18-469f-b2a0-bb34e004e42b">
					<ee:message />
					<ee:variables>
						<ee:set-variable variableName="flowNameClient"><![CDATA[%dw 2.0
output application/java
---
p('atp.flow.activateService')]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
		<flow-ref doc:name="Go to token and atp client" doc:id="60c05997-5196-4da0-b3b4-bc9edec0b466" name="post-atpServices-token-and-atp-client" />
	</sub-flow>
	<sub-flow name="post-atpServices-deactivateOnt" doc:id="f04ebb4d-ff49-41f6-8d33-74775f3e888b" >
		<choice doc:name="Choice" doc:id="57e6d8a5-b00a-4e33-86bd-e0ccf2db38cb">
			<when expression="#[(p('atp.muleValidation') splitBy &quot;|&quot; filter $ == &quot;deactivateOnt&quot;) != []]" >
				<ee:transform doc:name="Validate deleteONT body" doc:id="894543f1-1dde-4009-9435-2d6db421ca95">
					<ee:message />
					<ee:variables>
						<ee:set-variable variableName="validation_result"><![CDATA[%dw 2.0
output application/java

var service = sizeOf((payload.feature filter $.name == "service")  default []) != 0
var id = sizeOf((((payload.feature filter $.name == "service")  default [])[0].featureCharacteristic filter $.name == "id") default []) != 0
---
{
  isValid: service and id,
  error: if(!service) "service must not be empty" else
          if(!id) "id must not be empty" else
          null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</when>
			<otherwise >
				<ee:transform doc:name="Validate = true" doc:id="058c345c-e46d-40d0-a9b5-e143deab08ca" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java
---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</otherwise>
		</choice>
		<ee:transform doc:name="Set flowNameClient" doc:id="60ad54d8-4c1e-4f05-85eb-3ac3cadc06ba">
					<ee:message />
					<ee:variables>
						<ee:set-variable variableName="flowNameClient"><![CDATA[%dw 2.0
output application/java
---
p('atp.flow.deactivateOnt')]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
		<flow-ref doc:name="Go to token and atp client" doc:id="42226edc-be09-41c4-823c-ac32747d43bd" name="post-atpServices-token-and-atp-client" />
	</sub-flow>
	<sub-flow name="post-atpServices-deactivateService" doc:id="2baf35ac-19c6-4561-bdcf-a6441bc29b9b" >
		<choice doc:name="Choice" doc:id="46d34ffa-6c60-459e-8d75-2fc2d6b7d79d">
			<when expression="#[(p('atp.muleValidation') splitBy &quot;|&quot; filter $ == &quot;deactivateService&quot;) != []]" >
				<ee:transform doc:name="Validate deleteService body" doc:id="8c8ae7ba-55da-4a64-816a-aac04b7d6e97">
					<ee:message />
					<ee:variables>
						<ee:set-variable variableName="validation_result"><![CDATA[%dw 2.0
output application/java

var service = sizeOf((payload.feature filter $.name == "service")  default []) != 0
var id = sizeOf((((payload.feature filter $.name == "service")  default [])[0].featureCharacteristic filter $.name == "id") default []) != 0
---
{
  isValid: service and id,
  error: if(!service) "service must not be empty" else
          if(!id) "id must not be empty" else
          null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</when>
			<otherwise >
				<ee:transform doc:name="Validate = true" doc:id="596015cb-eee2-4d6d-bf87-b2653053170a" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java
---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</otherwise>
		</choice>
		<ee:transform doc:name="Set flowNameClient" doc:id="9da5fb14-0ad6-48d4-b1e7-0fc930554f95">
					<ee:message />
					<ee:variables>
						<ee:set-variable variableName="flowNameClient"><![CDATA[%dw 2.0
output application/java
---
p('atp.flow.deactivateService')]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
		<flow-ref doc:name="Go to token and atp client" doc:id="7d28efdf-1b84-42a4-a39a-1f8b2b6b5326" name="post-atpServices-token-and-atp-client" />
	</sub-flow>
	<sub-flow name="post-atpServices-resetONT" doc:id="589f4110-66ba-49bb-aca9-cd9344590135" >
		<choice doc:name="Choice" doc:id="a8e023b7-d98b-4edf-b595-cd6e2dd25336" >
			<when expression="#[(p('atp.muleValidation') splitBy &quot;|&quot; filter $ == &quot;resetONT&quot;) != []]">
				<ee:transform doc:name="Validate check body" doc:id="7b6515c6-a2de-400a-9104-f33b5361033b">
			<ee:message />
			<ee:variables>
				<ee:set-variable variableName="validation_result"><![CDATA[%dw 2.0
output application/java

var service = sizeOf((payload.feature filter $.name == "service")  default []) != 0
var id = sizeOf((((payload.feature filter $.name == "service")  default [])[0].featureCharacteristic filter $.name == "id") default []) != 0
---
{
  isValid: service and id,
  error: if(!service) "service must not be empty" else
          if(!id) "id must not be empty" else
          null
}]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
			</when>
			<otherwise >
				<ee:transform doc:name="Validate = true" doc:id="44c9d39d-a63c-4044-b036-3106578a103a" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java
---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</otherwise>
		</choice>
		<ee:transform doc:name="Set flowNameClient" doc:id="7c71e8e4-1658-4f39-992d-24fd8532d4a1" >
			<ee:message />
			<ee:variables >
				<ee:set-variable variableName="flowNameClient" ><![CDATA[%dw 2.0
output application/java
---
p('atp.flow.resetONT')]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<flow-ref doc:name="Go to token and atp client" doc:id="0bf3d366-4cfc-4f8f-9733-fd8434013335" name="post-atpServices-token-and-atp-client" />
	</sub-flow>
	<sub-flow name="post-atpServices-consultLevels" doc:id="31cda99d-3142-4ba2-b535-d6005d1a6bfe" >
		<choice doc:name="Choice" doc:id="5f8b518f-b96a-4e88-aa94-aab508c0138d" >
			<when expression="#[(p('atp.muleValidation') splitBy &quot;|&quot; filter $ == &quot;consultLevels&quot;) != []]" >
				<ee:transform doc:name="Validate check body" doc:id="d6fdb9ee-9ec6-44e7-9116-14577c3e1f32" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java

var service = sizeOf((payload.feature filter $.name == "service")  default []) != 0
var id = sizeOf((((payload.feature filter $.name == "service")  default [])[0].featureCharacteristic filter $.name == "id") default []) != 0
---
{
  isValid: service and id,
  error: if(!service) "service must not be empty" else
          if(!id) "id must not be empty" else
          null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</when>
			<otherwise >
				<ee:transform doc:name="Validate = true" doc:id="358192a6-9062-4f76-af01-c4a4f83d814d" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java
---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</otherwise>
		</choice>
		<ee:transform doc:name="Set flowNameClient" doc:id="cf9b315d-136f-4a88-9b69-41a93304795d" >
			<ee:message />
			<ee:variables >
				<ee:set-variable variableName="flowNameClient" ><![CDATA[%dw 2.0
output application/java
---
p('atp.flow.consultLevels')]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<flow-ref doc:name="Go to token and atp client" doc:id="4803b6a3-f2de-4d2b-aae6-b9903ecf7b33" name="post-atpServices-token-and-atp-client" />
	</sub-flow>
	<sub-flow name="post-atpServices-consultSpeed" doc:id="0361b4e2-fe79-449c-9914-1f9f84761bea" >
		<choice doc:name="Choice" doc:id="7e515566-9400-404b-9ac1-af12bbcc49be" >
			<when expression="#[(p('atp.muleValidation') splitBy &quot;|&quot; filter $ == &quot;consultSpeed&quot;) != []]" >
				<ee:transform doc:name="Validate check body" doc:id="fbacd044-ea76-47f8-b78c-cc09597d35d5" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java

var service = sizeOf((payload.feature filter $.name == "service")  default []) != 0
var id = sizeOf((((payload.feature filter $.name == "service")  default [])[0].featureCharacteristic filter $.name == "id") default []) != 0
---
{
  isValid: service and id,
  error: if(!service) "service must not be empty" else
          if(!id) "id must not be empty" else
          null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</when>
			<otherwise >
				<ee:transform doc:name="Validate = true" doc:id="712b3d09-36e4-497c-a06e-ac71961f3f38" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java
---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</otherwise>
		</choice>
		<ee:transform doc:name="Set flowNameClient" doc:id="22041664-1186-4dbc-99ca-81c48fe481f8" >
			<ee:message />
			<ee:variables >
				<ee:set-variable variableName="flowNameClient" ><![CDATA[%dw 2.0
output application/java
---
p('atp.flow.consultSpeed')]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<flow-ref doc:name="Go to token and atp client" doc:id="e8c325da-1670-4e00-8f24-8d8999da1bbe" name="post-atpServices-token-and-atp-client" />
	</sub-flow>
	<sub-flow name="post-atpServices-consultState" doc:id="605a499e-86d9-4e35-81b1-69001a32ab04" >
		<choice doc:name="Choice" doc:id="52cbda73-0473-4b9e-8635-e5e223008e4e" >
			<when expression="#[(p('atp.muleValidation') splitBy &quot;|&quot; filter $ == &quot;consultState&quot;) != []]" >
				<ee:transform doc:name="Validate check body" doc:id="b6b73467-7229-4c62-9d9d-8cd75a608055" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java

var service = sizeOf((payload.feature filter $.name == "service")  default []) != 0
var id = sizeOf((((payload.feature filter $.name == "service")  default [])[0].featureCharacteristic filter $.name == "id") default []) != 0
---
{
  isValid: service and id,
  error: if(!service) "service must not be empty" else
          if(!id) "id must not be empty" else
          null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</when>
			<otherwise >
				<ee:transform doc:name="Validate = true" doc:id="f77924e2-7735-4ffd-8048-e10e2f4e1ce1" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java
---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</otherwise>
		</choice>
		<ee:transform doc:name="Set flowNameClient" doc:id="a5f25821-7aa3-452e-aa8b-04406e685071" >
			<ee:message />
			<ee:variables >
				<ee:set-variable variableName="flowNameClient" ><![CDATA[%dw 2.0
output application/java
---
p('atp.flow.consultState')]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<flow-ref doc:name="Go to token and atp client" doc:id="25d94769-a24e-4a29-a016-6e35c141e2c9" name="post-atpServices-token-and-atp-client" />
	</sub-flow>
	<sub-flow name="post-atpServices-consultNeighbors" doc:id="d449b116-62cb-4a73-b480-419fd72b0d31" >
		<choice doc:name="Choice" doc:id="bdde3c05-13b9-4552-baa8-e581d56dd011" >
			<when expression="#[(p('atp.muleValidation') splitBy &quot;|&quot; filter $ == &quot;consultNeighbors&quot;) != []]" >
				<ee:transform doc:name="Validate check body" doc:id="58989ff5-c638-40d9-a256-61e935c9c39c" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java

var service = sizeOf((payload.feature filter $.name == "service")  default []) != 0
var id = sizeOf((((payload.feature filter $.name == "service")  default [])[0].featureCharacteristic filter $.name == "id") default []) != 0
---
{
  isValid: service and id,
  error: if(!service) "service must not be empty" else
          if(!id) "id must not be empty" else
          null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</when>
			<otherwise >
				<ee:transform doc:name="Validate = true" doc:id="0958a1bc-ab2c-4630-a46d-f502011869c7" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java
---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</otherwise>
		</choice>
		<ee:transform doc:name="Set flowNameClient" doc:id="22dd8baa-bdc6-437a-9b81-2bac11f95efd" >
			<ee:message />
			<ee:variables >
				<ee:set-variable variableName="flowNameClient" ><![CDATA[%dw 2.0
output application/java
---
p('atp.flow.consultNeighbors')]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<flow-ref doc:name="Go to token and atp client" doc:id="34789349-dc75-484d-8c16-08a83f5b3664" name="post-atpServices-token-and-atp-client" />
	</sub-flow>
	<sub-flow name="post-atpServices-serviceSuspension" doc:id="664f6fc0-13fd-44e0-8774-0df9e81ca2e6" >
		<choice doc:name="Choice" doc:id="b50243bd-8cb8-4212-9db2-a6ab61989eb5" >
			<when expression="#[(p('atp.muleValidation') splitBy &quot;|&quot; filter $ == &quot;serviceSuspension&quot;) != []]" >
				<ee:transform doc:name="Validate check body" doc:id="b3a48848-3c98-4c1b-a604-5a1ed775511b" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java

var service = sizeOf((payload.feature filter $.name == "service")  default []) != 0
var id = sizeOf((((payload.feature filter $.name == "service")  default [])[0].featureCharacteristic filter $.name == "id") default []) != 0
---
{
  isValid: service and id,
  error: if(!service) "service must not be empty" else
          if(!id) "id must not be empty" else
          null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</when>
			<otherwise >
				<ee:transform doc:name="Validate = true" doc:id="d973e149-7ee7-4ea3-96fb-268039138e4b" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java
---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</otherwise>
		</choice>
		<ee:transform doc:name="Set flowNameClient" doc:id="4511ec45-d9b1-4825-bf7f-3ef0aa3d4870" >
			<ee:message />
			<ee:variables >
				<ee:set-variable variableName="flowNameClient" ><![CDATA[%dw 2.0
output application/java
---
p('atp.flow.serviceSuspension')]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<flow-ref doc:name="Go to token and atp client" doc:id="eed54a57-202f-40c8-b6dd-f849f35e1689" name="post-atpServices-token-and-atp-client" />
	</sub-flow>
	<sub-flow name="post-atpServices-serviceReactivation" doc:id="51f73797-b0e3-4de2-8090-127f91f0e4d6" >
		<choice doc:name="Choice" doc:id="3c3a2767-0203-40de-a195-475985e1f4a7" >
			<when expression="#[(p('atp.muleValidation') splitBy &quot;|&quot; filter $ == &quot;serviceReactivation&quot;) != []]" >
				<ee:transform doc:name="Validate check body" doc:id="c8c5d876-5730-4f5b-b0f1-7750aea6d664" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java

var service = sizeOf((payload.feature filter $.name == "service")  default []) != 0
var id = sizeOf((((payload.feature filter $.name == "service")  default [])[0].featureCharacteristic filter $.name == "id") default []) != 0
---
{
  isValid: service and id,
  error: if(!service) "service must not be empty" else
          if(!id) "id must not be empty" else
          null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</when>
			<otherwise >
				<ee:transform doc:name="Validate = true" doc:id="de6aadb9-7729-4b1a-8938-71cb99708045" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java
---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</otherwise>
		</choice>
		<ee:transform doc:name="Set flowNameClient" doc:id="a78c3a6c-9cc7-42de-b6ae-6b6881b39bb5" >
			<ee:message />
			<ee:variables >
				<ee:set-variable variableName="flowNameClient" ><![CDATA[%dw 2.0
output application/java
---
p('atp.flow.serviceReactivation')]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<flow-ref doc:name="Go to token and atp client" doc:id="86eadc03-9529-4f18-bd9c-ad735d797e22" name="post-atpServices-token-and-atp-client" />
	</sub-flow>
	<sub-flow name="post-atpServices-speedChangeFeasibility" doc:id="662ea40f-402b-4f91-8a8b-32619350c720">
		<choice doc:name="Choice" doc:id="fb2a1668-4265-48d4-a1b3-946382b104a2">
			<when expression="#[(p('atp.muleValidation') splitBy &quot;|&quot; filter $ == &quot;speedChangeFeasibility&quot;) != []]">
				<ee:transform doc:name="Validate check body" doc:id="9ede67fe-b02e-40ee-97d5-e3dc448574b0">
			<ee:message />
			<ee:variables>
				<ee:set-variable variableName="validation_result"><![CDATA[%dw 2.0
output application/java

var component_id = sizeOf((payload.serviceQualificationItem[0].service.serviceCharacteristic filter ($.name == "component_id")) default []) != 0
var component_newUpBw = sizeOf((payload.serviceQualificationItem[0].service.serviceCharacteristic filter ($.name == "component_newUpBw")) default []) != 0
var component_newDownBw = sizeOf((payload.serviceQualificationItem[0].service.serviceCharacteristic filter ($.name == "component_newDownBw")) default []) != 0
---
{
  isValid: component_id and component_newUpBw and component_newDownBw,
  error: if(!component_id) "component_id must not be empty" else
          if(!component_newUpBw) "component_newUpBw must not be empty" else
          if(!component_newDownBw) "component_newDownBw must not be empty" else
          null
}]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
			</when>
			<otherwise >
				<ee:transform doc:name="Validate = true" doc:id="18546f76-fb4d-4b8c-b88d-b0f430551503" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java
---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</otherwise>
		</choice>
		<ee:transform doc:name="Set flowNameClient" doc:id="3deeac43-c5c7-4435-8acc-5330c409dc16">
			<ee:message />
			<ee:variables>
				<ee:set-variable variableName="flowNameClient"><![CDATA[%dw 2.0
output application/java
---
p('atp.flow.speedChangeFeasibility')]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<flow-ref doc:name="Go to token and atp client" doc:id="c65b9876-be68-4ee3-9ee3-b0fd861bb59f" name="post-atpServices-token-and-atp-client" />
	</sub-flow>
	<sub-flow name="post-atpServices-speedChangeCreateBooking" doc:id="6adb30b8-ec98-4a39-9885-ef58ef6bc3cd" >
		<choice doc:name="Choice" doc:id="7fdfb0ac-3499-421a-8f2a-fdc10442cbf1" >
			<when expression="#[(p('atp.muleValidation') splitBy &quot;|&quot; filter $ == &quot;speedChangeCreateBooking&quot;) != []]" >
				<ee:transform doc:name="Validate check body" doc:id="9586201a-b0cb-4516-bd82-5c0b768e8c2b" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java

var component_id = sizeOf((payload.serviceQualificationItem[0].service.serviceCharacteristic filter ($.name == "component_id")) default []) != 0
var component_newUpBw = sizeOf((payload.serviceQualificationItem[0].service.serviceCharacteristic filter ($.name == "component_newUpBw")) default []) != 0
var component_newDownBw = sizeOf((payload.serviceQualificationItem[0].service.serviceCharacteristic filter ($.name == "component_newDownBw")) default []) != 0
---
{
  isValid: component_id and component_newUpBw and component_newDownBw,
  error: if(!component_id) "component_id must not be empty" else
          if(!component_newUpBw) "component_newUpBw must not be empty" else
          if(!component_newDownBw) "component_newDownBw must not be empty" else
          null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</when>
			<otherwise >
				<ee:transform doc:name="Validate = true" doc:id="5aafd5e8-948f-41bf-8e04-a27ea7b49cfe" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java
---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</otherwise>
		</choice>
		<choice doc:name="Choice" doc:id="9d73da38-2db0-4c70-98bf-eb669626764b">
			<when expression="#[payload.serviceQualificationItem[0].expirationDate == null]">
				<ee:transform doc:name="Set expiration date" doc:id="7f2cefe4-fa95-4342-b31b-e96d0235392b">
					<ee:message>
						<ee:set-payload><![CDATA[%dw 2.0
import * from dw::core::Periods
output application/json
---
payload - "serviceQualificationItem" ++
{
  serviceQualificationItem: payload.serviceQualificationItem map ((item, index) ->  
  {
    expirationDate: ((now() + days(p('atp.days') as Number)) >> "GMT")
  } ++ (item - "expirationDate")
  )
}]]></ee:set-payload>
					</ee:message>
				</ee:transform>
			</when>
		</choice>
		<ee:transform doc:name="Set flowNameClient" doc:id="f5bd7e26-b8c9-46a2-809f-ef8a5a58ae70" >
			<ee:message />
			<ee:variables >
				<ee:set-variable variableName="flowNameClient" ><![CDATA[%dw 2.0
output application/java
---
p('atp.flow.speedChangeCreateBooking')]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<flow-ref doc:name="Go to token and atp client" doc:id="6286e46c-6f70-48c8-b83a-ce6a76a88773" name="post-atpServices-token-and-atp-client" />
	</sub-flow>
	<sub-flow name="post-atpServices-speedChangeCancelBooking" doc:id="551d4ef8-0493-427e-91e4-8d9b4e753a0b" >
		<choice doc:name="Choice" doc:id="c219be31-45a4-42bf-a629-f4cf08565815" >
			<when expression="#[(p('atp.muleValidation') splitBy &quot;|&quot; filter $ == &quot;speedChangeCancelBooking&quot;) != []]" >
				<ee:transform doc:name="Validate check body" doc:id="f38f4aa2-391b-4235-ab90-b002aada18b6" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java

var validId = payload.serviceQualificationItem[0].id != null
---
{
  isValid: validId,
  error: if(!validId) "service id must not be empty" else
          null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</when>
			<otherwise >
				<ee:transform doc:name="Validate = true" doc:id="744b36b1-b602-499b-92f7-f8fc8391a3cc" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java
---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</otherwise>
		</choice>
		<ee:transform doc:name="Set flowNameClient" doc:id="bfbc43a0-b8c2-4a95-9bc9-eb274ab2e228" >
			<ee:message />
			<ee:variables >
				<ee:set-variable variableName="flowNameClient" ><![CDATA[%dw 2.0
output application/java
---
p('atp.flow.speedChangeCancelBooking')]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<flow-ref doc:name="Go to token and atp client" doc:id="5b21cbde-604a-4846-b404-b273e826a454" name="post-atpServices-token-and-atp-client" />
	</sub-flow>
	<sub-flow name="post-atpServices-speedChange" doc:id="b1a9e6f2-87b4-4da9-b75e-8944863025a9" >
		<choice doc:name="Choice" doc:id="69df88cd-5210-4812-9b12-e0e8899643f6" >
			<when expression="#[(p('atp.muleValidation') splitBy &quot;|&quot; filter $ == &quot;speedChange&quot;) != []]" >
				<ee:transform doc:name="Validate check body" doc:id="e95f97c2-629b-4842-8cf4-04f536b1f792" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java

---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</when>
			<otherwise >
				<ee:transform doc:name="Validate = true" doc:id="ec85881e-6f36-4f18-b48f-12b19f99b13f" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="validation_result" ><![CDATA[%dw 2.0
output application/java
---
{
  isValid: true,
  error: null
}]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</otherwise>
		</choice>
		<ee:transform doc:name="Set flowNameClient" doc:id="8b40b3f7-d9f4-4774-bb56-696233502c2d" >
			<ee:message />
			<ee:variables >
				<ee:set-variable variableName="flowNameClient" ><![CDATA[%dw 2.0
output application/java
---
p('atp.flow.speedChange')]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<flow-ref doc:name="Go to token and atp client" doc:id="4e8b98bc-4f9d-47fa-9302-63c399bc323d" name="post-atpServices-token-and-atp-client" />
	</sub-flow>
</mule>
