<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="GetSubscriberInfo-dgo-orchestratorSub_Flow" doc:id="63dacfda-4428-4e6e-9cdc-29c95b668a08" >
		<try doc:name="Try" doc:id="175ea6e3-17a3-4761-8781-c71be56845dd" >
			<flow-ref doc:name="Go to client" doc:id="bdc9a9c9-04b5-4478-996e-8dcc544a48ce" name="GetSubscriberInfo-dgo-client" />
			<ee:transform doc:name="Set response" doc:id="f3a50be3-2399-4e30-ae38-fcc53b9f2975">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
			<ee:variables>
				<ee:set-variable variableName="httpStatus"><![CDATA[200]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
			<error-handler >
				<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="4674cdae-2141-4262-a436-924aba64ae40" >
					<flow-ref doc:name="Go to set error response" doc:id="e0d4bac1-5c26-4011-8511-7f4b437b9023" name="dgo-orchestrator-set-error-response" />
				</on-error-continue>
			</error-handler>
		</try>
	</sub-flow>
	<sub-flow name="EditSubscriber-dgo-orchestratorSub_Flow" doc:id="1054e6e5-99b9-453f-bdb7-34927dc2b58b" >
		<try doc:name="Try" doc:id="f064f0e9-7b01-40a8-b657-da218439146c" >
			<flow-ref doc:name="Go to client" doc:id="5eb660db-1439-494e-a7ea-c966cc289285" name="EditSubscriber-dgo-client" />
			<ee:transform doc:name="Set response" doc:id="4029f9f4-238f-4cb9-926b-a87920e298b3" >
				<ee:message >
					<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
				</ee:message>
				<ee:variables >
					<ee:set-variable variableName="httpStatus" ><![CDATA[200]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<error-handler >
				<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="95bd4895-cb8c-4612-b72e-343cbe5fa659" >
					<flow-ref doc:name="Go to set error response" doc:id="092ca74f-eb0e-447d-9d8d-969cab693331" name="dgo-orchestrator-set-error-response" />
				</on-error-continue>
			</error-handler>
		</try>
	</sub-flow>
	<sub-flow name="AccountRegistration-dgo-orchestratorSub_Flow" doc:id="ab70a6e7-fd00-4f05-af7e-dc36045e0ed4" >
		<ee:transform doc:name="Set request body" doc:id="f6b5e47d-01da-4ee5-9f90-b7c6e6e9b957">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
payload ++ {
  	"country_code": p('dgo.country'),
	"password": p('dgo.password')
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<try doc:name="Try" doc:id="15fd0e37-5a8b-4c7c-9af7-89f96892c785" >
			<flow-ref doc:name="Go to client" doc:id="08f6b768-831b-45b3-8d89-872e79e7d241" name="AccountRegistration-dgo-client" />
			<ee:transform doc:name="Set response" doc:id="bc3d6a41-b8b6-4edb-904f-231fa4ce8ea8" >
				<ee:message >
					<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
				</ee:message>
				<ee:variables >
					<ee:set-variable variableName="httpStatus" ><![CDATA[200]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<error-handler >
				<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="7a3a2e6f-02c3-4d78-9005-37615ee2ea71" >
					<flow-ref doc:name="Go to set error response" doc:id="b71fbdff-f52a-4dc0-844d-47878c499604" name="dgo-orchestrator-set-error-response" />
				</on-error-continue>
			</error-handler>
		</try>
	</sub-flow>
	<sub-flow name="AddURNs-dgo-orchestratorSub_Flow" doc:id="b4b4223e-1efb-40b4-9605-e7ba71c3d7ca" >
		<ee:transform doc:name="Set request body" doc:id="255a0337-86a1-4655-8e50-6655e4df5fbb" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload.urns default []]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<try doc:name="Try" doc:id="1d7f2c40-e16d-42d0-971f-7e9cbd97e854" >
			<flow-ref doc:name="Go to client" doc:id="ebd06655-0030-40cc-a452-1ade2447fe23" name="AddURNs-dgo-client" />
			<ee:transform doc:name="Set response" doc:id="98bf6aac-cd82-42d5-a584-e6e3db801748" >
				<ee:message >
					<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
				</ee:message>
				<ee:variables >
					<ee:set-variable variableName="httpStatus" ><![CDATA[200]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<error-handler >
				<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="1eff8186-fa35-4705-8ca9-aedb07939b50" >
					<flow-ref doc:name="Go to set error response" doc:id="a9c976c8-c6bc-463c-bf95-d7704e4f1962" name="dgo-orchestrator-set-error-response" />
				</on-error-continue>
			</error-handler>
		</try>
	</sub-flow>
	<sub-flow name="DeactivateUser-dgo-orchestratorSub_Flow" doc:id="389e0e44-d27b-4414-b42b-764ce5b8775b" >
		<try doc:name="Try" doc:id="a741b67f-a0d8-4948-a622-775edfea6ff4" >
			<flow-ref doc:name="Go to client" doc:id="0a0f41cb-7eaf-47da-a640-40d8e22b8937" name="DeactivateUser-dgo-client" />
			<ee:transform doc:name="Set response" doc:id="8ade0a2c-8d87-4ca6-a3d8-38a41372174f" >
				<ee:message >
					<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
				</ee:message>
				<ee:variables >
					<ee:set-variable variableName="httpStatus" ><![CDATA[200]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<error-handler >
				<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="a909c0ab-d18c-4adb-a24e-afb6a2c80884" >
					<flow-ref doc:name="Go to set error response" doc:id="bfed4b43-e44d-42a3-b6e0-722236d6de8a" name="dgo-orchestrator-set-error-response"/>
				</on-error-continue>
			</error-handler>
		</try>
	</sub-flow>
	<sub-flow name="dgo-orchestrator-set-error-response" doc:id="07216893-342e-47b5-9914-4f9da59e4c9a" >
		<ee:transform doc:name="Set response" doc:id="61c2c691-6822-4d73-b60c-07fddd98f057">
						<ee:message>
							<ee:set-payload><![CDATA[%dw 2.0
output application/json
import * from dw::core::Strings
---
{
  "status": error.errorMessage.payload.status default 400,
  "code": (error.errorMessage.payload.code default error.errorMessage.payload.details) default "INTERNAL_ERROR",
  "messageServer": "Internal error",
  "message": {
  	"message": error.errorMessage.payload.message default "Internal error",
  },
  "cause": [
    {
      "origin": "sisext-sapi-services-" ++ p('env'),
      "message": "org.mule.extension.http.api.exception." ++ (((error.errorMessage.payload.details default "INTERNAL_ERROR") splitBy "_" map ((item, index) -> capitalize(item)) reduce ((item, acc = "") -> 
    acc ++ item
)) ++ "Exception")
    }
  ]
}]]></ee:set-payload>
						</ee:message>
						<ee:variables>
							<ee:set-variable variableName="httpStatus"><![CDATA[error.errorMessage.payload.status default 400]]></ee:set-variable>
						</ee:variables>
					</ee:transform>
	</sub-flow>
</mule>
