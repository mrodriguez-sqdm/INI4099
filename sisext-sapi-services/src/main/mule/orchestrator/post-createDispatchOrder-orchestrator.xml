<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="post-createDispatchOrder-orchestratorSub_Flow" doc:id="d5bcfa9c-4b7d-4dd1-95a5-ea052dab9dd3" >
		<ee:transform doc:name="Prepare request" doc:id="0637dcdd-133b-4ba4-a403-c709d31f0fe9" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
var inputOrder = payload.createOrderRequest.createOrderIn.order
---
{
   "Envelope":{
      "Header":"",
      "Body":{
         "CrearOrdenRequest":{
            "CrearOrdenIn":{
               "WSRequestHeader2":{
                  "System":{
                     "name":"Suppla",
                     "correlationID":attributes.headers.'x-correlation-id',
                     "processingServer":"MDM"
                  }
               },
               "Orden":{
                  "ordenDespacho":attributes.uriParams.'order_id',
                  "cun": inputOrder.cunNumber,
                  "referencia": inputOrder.reference,
                  "fecha": inputOrder.date,
                  "reenvio":{
                     "ordenDespacho": inputOrder.resend.dispatchOrder,
                     "cantidad": inputOrder.resend.quantity
                  },
                  "tipo": inputOrder.orderType,
                  "tipoEntrega": inputOrder.entryType,
                  "observaciones": inputOrder.observations,
                  "recaudo":{
                     "requerido": inputOrder.collection.required,
                     "valor": inputOrder.collection.value
                  },
                  "direccion":{
                     "direccion": inputOrder.address.address,
                     "barrio": inputOrder.address.district,
                     "ciudad": inputOrder.address.city,
                     "departamento": inputOrder.address.department
                  },
                  "contacto":{
                     "nombres": inputOrder.contact.names,
                     "apellidos": inputOrder.contact.surnames,
                     "tipoDocumento": inputOrder.contact.documentType,
                     "numeroDocumento": inputOrder.contact.documentNumber,
                     "telefonoMovil": inputOrder.contact.mobilePhone,
                     "telefonoMovil2": inputOrder.contact.mobilePhone2,
                     "telefonoFijo": inputOrder.contact.phoneNumber,
                     "correo": inputOrder.contact.email
                  },
                  "item":{
                     "bodega": inputOrder.item.store,
                     "material": inputOrder.item.material,
                     "tipo": inputOrder.item."type",
                     "subtipo": inputOrder.item.subType,
                     "nombre": inputOrder.item.name,
                     "campana": inputOrder.item.campaign,
                     "valor": inputOrder.item.value,
                     "cantidad": inputOrder.item.quantity
                  }
               }
            }
         }
      }
   }
}]]></ee:set-payload>
			</ee:message>
			<ee:variables >
			</ee:variables>
		</ee:transform>
		<flow-ref doc:name="Go to Client" doc:id="4d2ddf18-ee4d-464c-baf9-a5b45f675f29" name="post-createDispatchOrder-clientSub_Flow"/>
	</sub-flow>
</mule>
