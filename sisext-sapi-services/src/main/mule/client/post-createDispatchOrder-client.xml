<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="post-createDispatchOrder-clientSub_Flow" doc:id="dd34db3a-4d3a-4713-ae91-35053d202d2c" >
		<async doc:name="Async" doc:id="f76d3515-7d28-4c05-badc-6e9e104ef41e">
				<flow-ref doc:name="Call Logger" doc:id="45a5937b-c4dd-4706-8afd-8c67afd5a0da" name="loggin-client-call" />
			</async>
		<http:request method="POST" doc:name="Request to inOrderService" doc:id="37e76551-feda-4317-8a47-c1e20159c593" requestStreamingMode="AUTO" config-ref="HTTP_Request_InOrderService" path="${inOrderService.path}">
			<http:headers><![CDATA[#[output application/java
---
{
	"secretKey" : p('inOrderService.secretKey'),
	"apiKey" : p('inOrderService.apiKey')
}]]]></http:headers>
		</http:request>
		<async doc:name="Async" doc:id="eb670cbf-15e1-4d68-b07f-ffcfedb68a47">
			<flow-ref doc:name="Call Logger" doc:id="f9c5f778-a5f3-4e60-96b1-55983f9e366f" name="loggin-client-call" />
		</async>
		<choice doc:name="Choice" doc:id="593c8256-2b4b-47ad-9f35-b0fa7579b9f0" >
			<when expression='#[(payload.Envelope.Body.CrearOrdenRequestResponse.return.WSResponseHeader2.Service.statusDetail.errorCode default "0") as Number == 0]'>
				<ee:transform doc:name="status 200" doc:id="61acebda-53b3-4838-8f7f-f10f9396ef61">
					<ee:message>
						<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{
  "status": 200,
  "code": "OK",
  "response": {
    "createOrderRequestResponse": payload.Envelope.Body.CrearOrdenRequestResponse
  }
}]]></ee:set-payload>
					</ee:message>
				</ee:transform>
			</when>
			<otherwise>
				<ee:transform doc:name="Error" doc:id="a9cc66b4-93a0-42af-ac98-03a00895bef9" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
	"status": (payload.Envelope.Body.CrearOrdenRequestResponse.return.WSResponseHeader2.Service.statusDetail.errorCode default "500") as Number,
	"code": payload.Envelope.Body.CrearOrdenRequestResponse.return.WSResponseHeader2.Service.statusDetail.errorCode,
	"message": {
		"message": payload.Envelope.Body.CrearOrdenRequestResponse.return.WSResponseHeader2.Service.statusDetail.errorMessage
	},
	"messageServer": "",
	"cause": [
		{
			"origin": "sisext-sapi-services",
			"message": "org.mule.extension.http.api.request.validator.ResponseValidatorTypedException"
		}
	]
}]]></ee:set-payload>
					</ee:message>
					<ee:variables >
						<ee:set-variable variableName="httpStatus" ><![CDATA[%dw 2.0
output application/java
---
(payload.Envelope.Body.CrearOrdenRequestResponse.return.WSResponseHeader2.Service.statusDetail.errorCode default "500") as Number]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</otherwise>
		</choice>
	
	</sub-flow>
</mule>
