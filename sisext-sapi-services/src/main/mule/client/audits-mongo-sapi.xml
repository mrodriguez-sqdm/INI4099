<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="audits-mongo-log-before" doc:id="de8a4c58-c4a3-4c7e-95d3-beb18080a1a7" >
		<ee:transform doc:name="Map Log Body" doc:id="4eba8862-1919-476e-aac3-abc7a83f6b0e" >
			<ee:message >
				<ee:set-payload ><![CDATA[output application/json
---
{
    "Identificador_Peticion": correlationId,
    "Sistema_Origen": "MULESOFT",
    "Servicio": vars.processname default "",
    "Operacion": flow.name,
    "TipoPista": "",
    "Fecha_Peticion": now() >> "America/Bogota",
    "Datos_Entrada": ((((write(payload.^raw, "application/json") default "NA")) replace "\n" with "") replace "\r" with "") replace "\t" with "",
    "Observaciones": "",
    "IP": ""
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<http:request method="POST" doc:name="Request to Audits Mongo" doc:id="030b98fc-fa8a-4661-a540-577e8f39bddc" config-ref="AuditsMongoSapi_Request_configuration" path="${audits-mongo-sapi.path}">
			<http:headers ><![CDATA[#[output application/java
---
{
	"X-CORRELATION-ID" : correlationId,
	"client_id": p('audits-mongo-sapi.client_id'),
	"client_secret" : p('audits-mongo-sapi.client_secret')
}]]]></http:headers>
			<http:uri-params ><![CDATA[#[output application/java
---
{
	api_id : p('api_id')
}]]]></http:uri-params>
		</http:request>
	</sub-flow>
	<sub-flow name="audits-mongo-log-after" doc:id="5af72c70-9226-4a5d-84e8-ddac2a9440c4" >
		<ee:transform doc:name="Map Log Body" doc:id="09d7b46a-4762-4d14-a9cf-bf07759fd633" >
			<ee:message >
				<ee:set-payload ><![CDATA[output application/json
---
{
    "Identificador_Peticion": correlationId,
    "Sistema_Origen": "MULESOFT",
    "Servicio": vars.processname default "",
    "Operacion": flow.name,
    "TipoPista": "",
    "Fecha_Peticion": now() >> "America/Bogota",
    "Datos_Entrada": ((((write(payload.^raw, "application/json") default "NA")) replace "\n" with "") replace "\r" with "") replace "\t" with "",
    "Observaciones": "",
    "IP": ""
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<http:request method="POST" doc:name="Request to Audits Mongo" doc:id="85940a83-2eed-4d3a-bb47-156b9e9725dd" config-ref="AuditsMongoSapi_Request_configuration" path="${audits-mongo-sapi.path}" >
			<http:headers ><![CDATA[#[output application/java
---
{
	"X-CORRELATION-ID" : correlationId,
	"client_id": p('audits-mongo-sapi.client_id'),
	"client_secret" : p('audits-mongo-sapi.client_secret')
}]]]></http:headers>
			<http:uri-params ><![CDATA[#[output application/java
---
{
	api_id : p('api_id')
}]]]></http:uri-params>
		</http:request>
	</sub-flow>
	<sub-flow name="audits-mongo-log-error" doc:id="462e3f49-a94e-4161-8dbb-9707e7c359a8" >
		<ee:transform doc:name="Map Log Body" doc:id="396ea852-08a6-4735-ae4f-821085030b51" >
			<ee:message >
				<ee:set-payload ><![CDATA[output application/json
---
{
    "Identificador_Peticion": correlationId,
    "Sistema_Origen": "MULESOFT",
    "Servicio": vars.processname default "",
    "Operacion": flow.name,
    "TipoPista": "",
    "Fecha_Peticion": now() >> "America/Bogota",
    "Datos_Entrada": (error.muleMessage.typedValue default "NA"),
    "Observaciones": "Error",
    "IP": ""
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<http:request method="POST" doc:name="Request to Audits Mongo" doc:id="23551fd0-19c0-4a6d-b945-60c23abd4399" config-ref="AuditsMongoSapi_Request_configuration" path="${audits-mongo-sapi.path}" >
			<http:headers ><![CDATA[#[output application/java
---
{
	"X-CORRELATION-ID" : correlationId,
	"client_id": p('audits-mongo-sapi.client_id'),
	"client_secret" : p('audits-mongo-sapi.client_secret')
}]]]></http:headers>
			<http:uri-params ><![CDATA[#[output application/java
---
{
	api_id : p('api_id')
}]]]></http:uri-params>
		</http:request>
	</sub-flow>
</mule>