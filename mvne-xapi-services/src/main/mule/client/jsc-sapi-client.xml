<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd">
	<sub-flow name="get-subscriber-client" doc:id="3a3d2185-6293-4cbb-b458-466db6249ad6" >
		<try doc:name="Try" doc:id="91e799ec-e461-4c1a-b942-1941519e1976" >
			<http:request method="GET" doc:name="Get subscriber" doc:id="d622afda-de3a-401e-96cf-38efec29c5ba" config-ref="HTTP_Request_configuration_jsc" path="${jsc-sapi.subscriber.path}" target="subscriberObject" >
				<http:headers ><![CDATA[#[output application/java
---
{
	"client_secret" : p('jsc-sapi.client_secret'),
	
	"client_id" : p('jsc-sapi.client_id'),
	"correlationId" : correlationId,
	"systemId" : vars.systemId,
	"processName": vars.processname,
	"logs": vars.logs
}]]]></http:headers>
				<http:query-params ><![CDATA[#[output application/java
---
{
	"externalID" : vars.externalID_destino
}]]]></http:query-params>
			</http:request>
			<error-handler >
				<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="9646267c-c837-49c2-898a-31460c6d883c" >
					<set-variable value="#[p('jsc-sapi.subscriber.errorMessage')]" doc:name="Set Error Message" doc:id="1a3e39cc-751e-45ba-bd9f-d3e3bc15de60" variableName="errorMessageOutput" />
				</on-error-propagate>
			</error-handler>
		</try>
	</sub-flow>
	<sub-flow name="post-subscriber-client" doc:id="e1e0d378-0977-437c-b055-cc210bdc913d" >
		<http:request method="POST" doc:name="Post subscriber" doc:id="57968999-a132-4732-bf52-cac73f42a24e" config-ref="HTTP_Request_configuration_jsc" path="${jsc-sapi.subscriber.path}" target="subscriberObject" >
			<http:headers ><![CDATA[#[output application/java
---
{
	"client_secret" : p('jsc-sapi.client_secret'),
	
	"client_id" : p('jsc-sapi.client_id'),
	"correlationId" : correlationId,
	"systemId" : vars.systemId,
	"processName": vars.processname,
	"logs": vars.logs
}]]]></http:headers>
		</http:request>
	</sub-flow>
	<sub-flow name="get-subscription-client-by-msisdn" doc:id="f1350dcb-c836-45d0-ac82-cf6d84c79616" >
		<try doc:name="Try" doc:id="4ea84449-60ff-47ae-a7e1-423a8362412b" >
			<http:request method="GET" doc:name="Get subscription by msisdn" doc:id="368f39c9-124b-46bd-ac61-05f433189c91" config-ref="HTTP_Request_configuration_jsc" path="${jsc-sapi.subscription.path}" >
				<http:headers ><![CDATA[#[output application/java
---
{
	"client_secret" : p('jsc-sapi.client_secret'),
	"client_id" : p('jsc-sapi.client_id'),
	"correlationId" : correlationId,
	("systemId" : vars.systemId) if (vars.systemId != null),
	"processName": vars.processname,
	"logs": vars.logs
}]]]></http:headers>
				<http:query-params ><![CDATA[#[output application/java
---
{
	"msisdn" : vars.msisdn
}]]]></http:query-params>
			</http:request>
			<error-handler >
				<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="14a323d4-449f-4c50-ba83-c0236deba06c" >
					<set-variable value="#[p('jsc-sapi.subscription.errorMessage')]" doc:name="Set Error Message" doc:id="6c84809a-3749-4c9a-a118-d5e72275b70a" variableName="errorMessageOutput" />
				</on-error-propagate>
			</error-handler>
		</try>
	</sub-flow>
	<sub-flow name="post-assignSubscriptionToSubscriber-client" doc:id="047a3273-114a-456e-999f-f01b78c0533b" >
		<try doc:name="Try" doc:id="b940aebb-304a-44b2-b4ba-75d7f9986b52" >
			<http:request method="POST" doc:name="Assign subscription to subscriber" doc:id="c776a743-d71d-421e-9ba8-1bc87f7e0830" config-ref="HTTP_Request_configuration_jsc" path="${jsc-sapi.assignSubscriptionToSubscriber.path}" target="assignSubscriptionToSubscriberResp" >
				<http:headers ><![CDATA[#[output application/java
---
{
	"client_secret" : p('jsc-sapi.client_secret'),
	
	"client_id" : p('jsc-sapi.client_id'),
	"correlationId" : correlationId,
	"systemId" : vars.systemId,
	"processName": vars.processname,
	"logs": vars.logs
}]]]></http:headers>
				<http:uri-params ><![CDATA[#[output application/java
---
{
	"subscription_id" : vars.subscription_id,
	"subscriber_id" : vars.subscriber_id
}]]]></http:uri-params>
			</http:request>
			<error-handler >
				<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="710274d5-9883-4077-8a02-8e63ade13256" >
					<set-variable value="#[p('jsc-sapi.createBillingAccount.ba.errorMessage2')]" doc:name="Set Error Message" doc:id="809a156f-0d97-4c64-9055-9b57e8a287b4" variableName="errorMessageOutput" />
				</on-error-propagate>
			</error-handler>
		</try>
	</sub-flow>
	<sub-flow name="get-billingSubscription-client" doc:id="f86396fb-7790-49ed-a2a3-7b09c187937e" >
		<try doc:name="Try" doc:id="44a45c75-c650-4149-aa04-8454e33d42f4" >
			<http:request method="GET" doc:name="Billing Subscription" doc:id="4c0ab194-b435-4d4d-b6bf-738339d1bfa6" config-ref="HTTP_Request_configuration_jsc" path="${jsc-sapi.billingAccount.consult.path}" >
				<http:headers ><![CDATA[#[output application/java
---
{
	"client_secret" : p('jsc-sapi.client_secret'),	
	"client_id" : p('jsc-sapi.client_id'),
	"correlationId" : correlationId,
	"systemId" : vars.systemId,
	"processName": vars.processname,
	"logs": vars.logs
}]]]></http:headers>
				<http:uri-params ><![CDATA[#[output application/java
---
{
	"subscription_id" : vars.orderObject.subscription.id
}]]]></http:uri-params>
				<http:query-params ><![CDATA[#[output application/java
---
{
	"externalID" : vars.externalID
}]]]></http:query-params>
			</http:request>
			<error-handler >
				<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="bc7906bd-5b49-4b1f-9202-ba1303e83270" >
					<set-variable value="#[p('jsc-sapi.createBillingAccount.subscription.errorMessage')]" doc:name="Set Error Message" doc:id="e574a881-b910-43be-8d38-b278a5fc8042" variableName="errorMessageOutput" />
				</on-error-propagate>
			</error-handler>
		</try>
	</sub-flow>
	<sub-flow name="patch-billingSubscription-client" doc:id="343d5e18-73bf-4114-94db-0d9c816db010" >
		<try doc:name="Try" doc:id="4e96b6a3-7f22-47df-ad49-c3abc23e6f6e" >
			<http:request method="PATCH" doc:name="Billing Subscription" doc:id="26ffc4d7-9c15-47ab-a188-80b42f2cbcc4" config-ref="HTTP_Request_configuration_jsc" path="${jsc-sapi.billingAccount.modify.path}" >
				<http:headers ><![CDATA[#[output application/java
---
{
	"client_secret" : p('jsc-sapi.client_secret'),	
	"client_id" : p('jsc-sapi.client_id'),
	"correlationId" : correlationId,
	"systemId" : vars.systemId,
	"processName": vars.processname,
	"logs": vars.logs
}]]]></http:headers>
				<http:uri-params ><![CDATA[#[output application/java
---
{
	"id" : vars.billingId
}]]]></http:uri-params>
			</http:request>
			<error-handler >
				<on-error-propagate enableNotifications="true" logException="true" doc:name="On Error Propagate" doc:id="c52bcc1f-d509-4116-8414-47b5491b1172" >
					<set-variable value="#[p('jsc-sapi.createBillingAccount.subscription.errorMessage')]" doc:name="Set Error Message" doc:id="cc85a638-b879-4505-a752-0484460b230d" variableName="errorMessageOutput" />
				</on-error-propagate>
			</error-handler>
		</try>
	</sub-flow>
</mule>
