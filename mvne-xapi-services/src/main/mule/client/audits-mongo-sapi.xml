<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="audits-mongo-log-before" doc:id="6b90ad2c-260a-447f-9ee5-8c03b0d66bd1" >
		<http:request method="POST" doc:name="Request to Audits Mongo" doc:id="87a5f914-e664-4c30-b8f2-fd2fc5ae1743" config-ref="AuditsMongoSapi_Request_configuration" path="${audits-mongo-sapi.path}">
			<http:headers ><![CDATA[#[output application/java
---
{
	"X-CORRELATION-ID" : correlationId,
	"client_id": p('audits-mongo-sapi.client_id'),
	"client_secret" : p('audits-mongo-sapi.client_secret')
}]]]></http:headers>
			<http:uri-params ><![CDATA[#[output application/java
---
{
	api_id : p('api_id')
}]]]></http:uri-params>
		</http:request>
	</sub-flow>
	<sub-flow name="audits-mongo-log-after" doc:id="20ccb068-d008-4877-878e-19e3f0860147" >
		<ee:transform doc:name="Map Log Body" doc:id="d1faf390-4594-4f19-a28c-4498b7f21c09">
			<ee:message>
				<ee:set-payload><![CDATA[output application/json
---
{
    "Identificador_Peticion": correlationId,
    "Sistema_Origen": "MULESOFT",
    "Servicio": vars.processname default "",
    "Operacion": flow.name,
    "TipoPista": "",
    "Fecha_Peticion": now() >> "America/Bogota",
    "Datos_Entrada": ((((payload.^raw default "NA") as String) replace "\n" with "") replace "\r" with "") replace "\t" with "",
    "Observaciones": "",
    "IP": ""
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<http:request method="POST" doc:name="Request to Audits Mongo" doc:id="0c9b424f-a329-4c76-993b-511154241cfe" config-ref="AuditsMongoSapi_Request_configuration" path="${audits-mongo-sapi.path}" >
			<http:headers ><![CDATA[#[output application/java
---
{
	"X-CORRELATION-ID" : correlationId,
	"client_id": p('audits-mongo-sapi.client_id'),
	"client_secret" : p('audits-mongo-sapi.client_secret')
}]]]></http:headers>
			<http:uri-params ><![CDATA[#[output application/java
---
{
	api_id : p('api_id')
}]]]></http:uri-params>
		</http:request>
	
</sub-flow>
	<sub-flow name="audits-mongo-log-error" doc:id="146b215e-5034-4a3c-8c7e-a9357bdc3941" >
		<ee:transform doc:name="Map Log Body" doc:id="9c660073-deec-4a8d-9f2d-3718f9518ebf">
			<ee:message>
				<ee:set-payload><![CDATA[output application/json
---
{
    "Identificador_Peticion": correlationId,
    "Sistema_Origen": "MULESOFT",
    "Servicio": vars.processname default "",
    "Operacion": flow.name,
    "TipoPista": "",
    "Fecha_Peticion": now() >> "America/Bogota",
    "Datos_Entrada": (error.muleMessage.typedValue default "NA"),
    "Observaciones": "Error",
    "IP": ""
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<http:request method="POST" doc:name="Request to Audits Mongo" doc:id="7663a893-6ea7-4759-9d54-45574f810a30" config-ref="AuditsMongoSapi_Request_configuration" path="${audits-mongo-sapi.path}" >
			<http:headers ><![CDATA[#[output application/java
---
{
	"X-CORRELATION-ID" : correlationId,
	"client_id": p('audits-mongo-sapi.client_id'),
	"client_secret" : p('audits-mongo-sapi.client_secret')
}]]]></http:headers>
			<http:uri-params ><![CDATA[#[output application/java
---
{
	api_id : p('api_id')
}]]]></http:uri-params>
		</http:request>
	
</sub-flow>
</mule>