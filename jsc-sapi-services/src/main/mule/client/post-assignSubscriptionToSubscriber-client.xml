<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="post-assignSubscriptionToSubscriber-clientSub_Flow" doc:id="a5f58ae2-9988-42cd-8479-10814cb5bc57" >
		<try doc:name="Try" doc:id="0b42796a-ddc9-45a0-8837-9aa3789e1cb1" >
			<choice doc:name="Choice" doc:id="faa67bd7-af8a-4f54-8e85-5752ef4bac83">
			<when expression="#[payload.idBillingAccount != null]">
				<flow-ref doc:name="move subcription with ba" doc:id="ddb5d2c4-cea9-4f2d-960b-31a4da5502c9" name="post-assignSubscriptionToSubscriberBA-clientSub_Flow" />
			</when>
			<otherwise>
				<flow-ref doc:name="move subcription without ba" doc:id="d4382e27-e652-47dc-9faa-f0b18e5ce159" name="post-assignSubscriptionToSubscriberNoBA-clientSub_Flow" />
			</otherwise>
		</choice>
			<error-handler >
				<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="f230e3e1-4f69-4bd8-9577-9d71dd70dd72" >
					<flow-ref doc:name="move subcription without ba" doc:id="27e55a08-eec6-498f-962e-70920929eba0" name="post-assignSubscriptionToSubscriberNoBA-clientSub_Flow"/>
				</on-error-continue>
			</error-handler>
		</try>
	</sub-flow>
	<sub-flow name="post-assignSubscriptionToSubscriberBA-clientSub_Flow" doc:id="accdb6a8-1e3f-4398-8e27-d6b7d2bd69b1" >
		<try doc:name="Try" doc:id="26551a02-505b-4dd8-96e5-907a8609323b" >
			<set-payload value='#[%dw 2.0&#10;output application/json&#10;---&#10;{&#10;  "keepCounters": true,&#10;  "pkglDList": true,&#10;  "idBillingAccount": payload.idBillingAccount&#10;}]' doc:name="Set Payload" doc:id="0acaccb9-3b5b-4ba2-a912-272466a0f297" />
			<http:request method="PUT" doc:name="Request to assign subcription to subscriber JSC" doc:id="c6ebf4cc-84f3-4f4d-9cc5-b008ca8e0109" config-ref="JSC_Request_configuration" path="${jsc.path.post-assignSubscriptionToSubscriber}" >
				<http:headers ><![CDATA[#[output application/java
---
{
	Authorization : vars.token
}]]]></http:headers>
				<http:uri-params ><![CDATA[#[output application/java
---
{
	"subscription_id" : attributes.uriParams.subscription_id,
	"subscriber_id" : attributes.uriParams.subscriber_id
}]]]></http:uri-params>
			</http:request>
			<error-handler >
				<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="a9f1de06-82b4-4e33-b229-a8abd47bb246" >
					<logger level="INFO" doc:name="Logger" doc:id="29c066bb-72a3-4c71-847c-28de34f8609a" message="#[error]" category="error"/>
				</on-error-continue>
			</error-handler>
		</try>
	</sub-flow>
	<sub-flow name="post-assignSubscriptionToSubscriberNoBA-clientSub_Flow" doc:id="6fdd114a-cd95-4706-a206-bfdf41ddc25f" >
		<try doc:name="Try" doc:id="31df5e80-5efe-40b4-8604-05c21b42bd2b" >
			<set-payload value='#[%dw 2.0&#10;output application/json&#10;---&#10;{&#10;  "keepCounters": true,&#10;  "pkglDList": true&#10;}]' doc:name="Set Payload" doc:id="61a9fd03-e005-4b05-bb06-189a0eaf9cfa" />
			<http:request method="PUT" doc:name="Request to assign subcription to subscriber JSC" doc:id="c6f911c4-b0a5-4927-b093-2c5ed25a6125" config-ref="JSC_Request_configuration" path="${jsc.path.post-assignSubscriptionToSubscriber}" >
				<http:headers ><![CDATA[#[output application/java
---
{
	Authorization : vars.token
}]]]></http:headers>
				<http:uri-params ><![CDATA[#[output application/java
---
{
	"subscription_id" : attributes.uriParams.subscription_id,
	"subscriber_id" : attributes.uriParams.subscriber_id
}]]]></http:uri-params>
			</http:request>
			<error-handler >
				<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="41b56655-66b6-429a-9b68-cc630a612194" >
					<logger level="INFO" doc:name="Logger" doc:id="efab337c-6ad7-4751-97db-bbc96f31c54c" message="#[error]" category="error"/>
				</on-error-continue>
			</error-handler>
		</try>
	</sub-flow>
</mule>
