<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="post-send-message-orchestratorSub_Flow" doc:id="4cd1b8c7-8e5a-4feb-85e9-ea10e7b58159" >
		<ee:transform doc:name="Set payload for queue" doc:id="62fd7d58-0902-448c-99dc-164c24fe29c4" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
    message: vars.originalMessage,
    uuids: vars.uuids,
    createdAt: (now() >> "America/Bogota") as String {format: "yyyy-MM-dd'T'HH:mm:ssXXX"},
    status: "pending",
    priority: vars.originalMessage.category match {
        case "OTP" -> "1"
        case "REGULATORY" -> "2"
        case "CAMPAIGN" -> "3"
	}    

}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<flow-ref doc:name="Go to Client" doc:id="15815fa4-000c-42da-a230-c1a17710e135" name="post-send-message-enrutador-datos"/>
	</sub-flow>
</mule>
