<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="get-services-from-mdm-cd-servicio-and-mdm-servicio-activo" doc:id="5b1be6b0-ccf6-4341-b551-821f36f9f6b7" >
		<scatter-gather doc:name="Scatter-Gather" doc:id="5ea32d97-db5d-4b86-9866-63aa95df021b" >
			<route >
				<ee:transform doc:name="Set request input" doc:id="01abb309-9ad8-4d6d-850e-33c0fdb68206" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="activo" ><![CDATA[%dw 2.0
output application/java
---
"N"]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
				<try doc:name="Try" doc:id="0382214a-e6bd-4710-b691-4b64d2d885cf" >
					<flow-ref doc:name="Go to get services from MDM_CD_SERVICIO" doc:id="a5c3d39c-2e80-4e84-ba0a-6992c42956fe" name="get-services_mongo-clientSub_Flow" />
					<error-handler >
						<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="9c35c5ae-7c88-412e-a916-fd1603304d95" type="HTTP:NOT_FOUND" >
							<ee:transform doc:name="Set services array in payload to empty" doc:id="3ae4bb15-892e-4a67-b237-fa19e47b338f" >
								<ee:message >
									<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
[]]]></ee:set-payload>
								</ee:message>
							</ee:transform>
						</on-error-continue>
					</error-handler>
				</try>
			</route>
			<route >
				<ee:transform doc:name="Set request input" doc:id="2bc2b392-c4bd-470a-8b1a-a09110397b43" >
					<ee:message />
					<ee:variables >
						<ee:set-variable variableName="activo" ><![CDATA[%dw 2.0
output application/java
---
"Y"]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
				<try doc:name="Try" doc:id="eaa4d5c6-c2ee-483c-a701-1d1601eea5f6" >
					<flow-ref doc:name="Go to get services from MDM_SERVICIO_ACTIVO" doc:id="69a3ca55-67d3-4c4b-aa81-73b6c9e8e59f" name="get-services_mongo-clientSub_Flow" />
					<ee:transform doc:name="Filter services" doc:id="f5a371ff-a9de-4659-a7f8-145761fd137e" >
						<ee:message >
							<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload filter ($.Id_Activo_Padre == " - 1" or $.Id_Activo_Padre == "" or ($.Id_Activo_Padre == $.Id_Activo_Sistema_Origen))]]></ee:set-payload>
						</ee:message>
					</ee:transform>
					<error-handler >
						<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="07323547-f2c4-4c3a-a8a1-01fe1dcbb305" type="HTTP:NOT_FOUND" >
							<ee:transform doc:name="Set services array in payload to empty" doc:id="8e2c32e0-f08c-4405-a446-a0d1ad8f794d" >
								<ee:message >
									<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
[]]]></ee:set-payload>
								</ee:message>
							</ee:transform>
						</on-error-continue>
					</error-handler>
				</try>
			</route>
		</scatter-gather>
		<ee:transform doc:name="Transform Message" doc:id="f92844f8-2804-4974-92d7-32aaff557ca8" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
	</sub-flow>
</mule>
