<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="get-offers-mongo"
		doc:id="e2b43b71-4f97-4e41-88a3-0292e5668999">
		<http:request method="GET" doc:name="Get Offer"
			doc:id="003de993-484f-43ff-894b-1600469e3081"
			config-ref="HTTP_Request_configuration_mongo"
			path="${mongo-sapi.offers.path}" target="jscToken"
			targetValue='#["Bearer " ++ payload.accessToken]'>
			<http:headers><![CDATA[#[output application/java
---
{
	"client_secret" :  p('mongo-sapi.client_secret'),
	"client_id" :  p('mongo-sapi.client_id')
}]]]></http:headers>
		</http:request>
	</sub-flow>
	<sub-flow name="get-commercial-catalog"
		doc:id="1c5e7707-8fa4-4147-942b-a9c8a2b541f1">
		<http:request method="GET"
			doc:name="Request to get commercial catalog from CATALOGO_COMERCIAL_SVAS"
			doc:id="526bddda-e9f4-4f5e-91d2-a2963fc513d0"
			config-ref="HTTP_Request_configuration_mongo"
			path="${mongo-sapi.path.commercialCatalog}">
			<http:headers><![CDATA[#[output application/java
---
{
	"source": vars.headers.source,
	"name" : vars.headers.name,
	"X-CORRELATION-ID" :  correlationId,
	"client_secret" : p('mongo-sapi.client_secret'),
	"systemId": vars.headers.systemId,
	"client_id" : p('mongo-sapi.client_id'),
	"processName" : vars.headers.processName
}]]]></http:headers>
		</http:request>
	</sub-flow>
	<sub-flow name="get-referredServices-client" doc:id="4828e151-197c-4446-a2e0-48683c8791c0" >
		<http:request method="GET" doc:name="Get referred Services" doc:id="88c98722-81cd-434b-abe6-811a5608bacb" config-ref="HTTP_Request_configuration_mongo" path="${mongo-sapi.path.services}">
			<http:headers ><![CDATA[#[output application/java
---
{
	"client_secret" :  p('mongo-sapi.client_secret'),
	"client_id" :  p('mongo-sapi.client_id'),
	"source" : attributes.headers.'source',
	"X-CORRELATION-ID": correlationId,
	"name" : attributes.headers.'name'
		}]]]></http:headers>
			<http:query-params ><![CDATA[#[output application/java
---
{
	"numeroDoc" : vars.numeroDocumento,
	"tipoDoc" : vars.tipoDocumento
}]]]></http:query-params>
		</http:request>
	</sub-flow>
	<sub-flow name="get-typeParameter-client" doc:id="98a00889-9ddb-4b6a-a649-d8a8a21af22d" >
		<http:request method="GET" doc:name="Get typeParameter" doc:id="66afb5cd-4623-44ed-85f2-d094630b971a" config-ref="HTTP_Request_configuration_mongo" path="${mongo-sapi.path.typeParameter}" >
			<http:headers ><![CDATA[#[output application/java
---
{
	"client_secret" :  p('mongo-sapi.client_secret'),
	"client_id" :  p('mongo-sapi.client_id'),
	"systemId" : "OTINICIATIVAS",
	"source" : attributes.headers.'source',
	"X-CORRELATION-ID": correlationId,
	"name" : attributes.headers.'name'
}]]]></http:headers>
			<http:uri-params ><![CDATA[#[output application/java
---
{
	"typeParameter" : p('referred.typeParameter')
}]]]></http:uri-params>
		</http:request>
	</sub-flow>
	<sub-flow name="patch-referido-empleados" doc:id="637e9c17-5c5c-461c-91f2-e4d01c045493">
		<http:request method="PATCH" doc:name="Request mongo-sapi" doc:id="8b042f8b-0cc1-4639-aa97-6a486a2ebee8" config-ref="HTTP_Request_configuration_mongo" path="${mongo-sapi.getReferral.path}">
			<http:headers><![CDATA[#[output application/java
---
{
	"source" : attributes.headers.'source',
	"X-CORRELATION-ID": correlationId,
	"name" : attributes.headers.'name',
	"client_secret" : p('mongo-sapi.client_secret'),
	"client_id" : p('mongo-sapi.client_id')
}]]]></http:headers>
	<http:query-params><![CDATA[#[output application/java
---
{
	"tipoDocumento" : vars.tipoDocumento,
	"numeroDocumentoReferido" : vars.numeroDocumentoReferido,
	"numeroIdentificacion" : vars.numeroDocumento,
	"tipoDocumentoReferido" : vars.tipoDocumentoReferido
}]]]></http:query-params>
		</http:request>
	</sub-flow>
	<sub-flow name="get-client-client" doc:id="5a25cb2e-d48e-42fb-85c9-fe358a396b33">
		<http:request method="GET" doc:name="Request mongo-sapi" doc:id="06df0224-4a20-4e7f-8457-aefb2f6274d8" config-ref="HTTP_Request_configuration_mongo" path="${mongo-sapi.getClient.path}">
			<http:headers><![CDATA[#[output application/java
---
{
	"source" : attributes.headers.'source',
	"X-CORRELATION-ID": correlationId,
	"name" : attributes.headers.'name',
	"client_secret" : p('mongo-sapi.client_secret'),
	"client_id" : p('mongo-sapi.client_id'),
	"systemId" : "OTINICIATIVAS"
}]]]></http:headers>
			<http:query-params><![CDATA[#[output application/java
---
{
	"tipoDocumento" : vars.tipoDocumento,
	"numeroIdentificacion" : vars.numeroDocumento
}]]]></http:query-params>
		</http:request>
	</sub-flow>
	<sub-flow name="get-referido-empleados" doc:id="78a8584e-e065-447e-ba48-9b7247514db8">
		<http:request method="GET" doc:name="Request mongo-sapi" doc:id="b79ea020-ad37-4ad7-8f01-fb858c36019b" config-ref="HTTP_Request_configuration_mongo" path="${mongo-sapi.getReferral.path}">
			<http:headers><![CDATA[#[output application/java
---
{
	"source" : attributes.headers.'source',
	"X-CORRELATION-ID": correlationId,
	"name" : attributes.headers.'name',
	"client_secret" : p('mongo-sapi.client_secret'),
	"client_id" : p('mongo-sapi.client_id')
}]]]></http:headers>
			<http:query-params><![CDATA[#[output application/java
---
{
	"tipoDocumento" : vars.tipoDocumentoReferido,
	"numeroIdentificacion" : vars.numeroDocumentoReferido
}]]]></http:query-params>
		</http:request>
	</sub-flow>
	<sub-flow name="patch-client-client" doc:id="7e9c13c4-047e-4f7e-bd50-b9d5f2cb9bfb">
		<http:request method="PATCH" doc:name="Request mongo-sapi" doc:id="bb629e61-7510-4f2f-8ff0-00a062347b62" config-ref="HTTP_Request_configuration_mongo" path="${mongo-sapi.getClient.path}">
			<http:headers><![CDATA[#[output application/java
---
{
	"source" : attributes.headers.'source',
	"X-CORRELATION-ID": correlationId,
	"name" : attributes.headers.'name',
	"client_secret" : p('mongo-sapi.client_secret'),
	"client_id" : p('mongo-sapi.client_id'),
	"systemId": "OTINICIATIVAS"
}]]]></http:headers>
	<http:query-params><![CDATA[#[output application/java
---
{
	"tipoDocumento" : vars.tipoDocumento,
	"numeroIdentificacion" : vars.numeroDocumento
}]]]></http:query-params>
		</http:request>
	</sub-flow>
	<sub-flow name="get-usuario_portal_unificado_mongo-clientSub_Flow" doc:id="0b42eb3f-f548-4458-850b-f9846b73506f">
		<http:request method="GET" doc:name="Call get usuario" doc:id="d8952095-eeb8-4b59-b7e5-92038ebed4e2" config-ref="HTTP_Request_configuration_mongo" path="${mongo-sapi.usuarios.path}" >
			<http:headers><![CDATA[#[output application/java
---
{
	"source" : "",
	"name" : vars.headers.name,
	"X-CORRELATION-ID" : vars.headers.'X-CORRELATION-ID' default correlationId,
	"client_secret" : p('mongo-sapi.client_secret'),
	"systemId" : "OTINICIATIVAS",
	"client_id" : p('mongo-sapi.client_id')
}]]]></http:headers>
			<http:query-params><![CDATA[#[output application/java
---
{
	"numeroDocumento" : vars.numeroIdentificacion,
	"tipoDocumento" : vars.tipoIdentificacion
}]]]></http:query-params>
		</http:request>
	</sub-flow>
	<sub-flow name="get-product-offer"
		doc:id="300e5a2c-d436-43c8-8669-7cde98e872e4">
		<http:request method="POST"
			doc:name="Request to get product offer from CMP_OFERTA_PRODUCTO"
			doc:id="3d76baa9-6dbd-4cb5-b737-e8489d2c2edf"
			config-ref="HTTP_Request_configuration_mongo"
			path="${mongo-sapi.path.productOffer}">
			<http:headers><![CDATA[#[output application/java
---
{
	"source": vars.headers.source,
	"name" : vars.headers.name,
	"X-CORRELATION-ID" :  correlationId,
	"client_secret" : p('mongo-sapi.client_secret'),
	"systemId": vars.headers.systemId,
	"client_id" : p('mongo-sapi.client_id'),
	"processName" : vars.headers.processName
}]]]></http:headers>
		</http:request>
	</sub-flow>
	<sub-flow name="get-catalog-clientSub_Flow"
		doc:id="da13628f-7a2f-4296-9b8c-68d8afe43e90">
		<http:request method="GET" doc:name="Get catalog"
			doc:id="08c08175-76af-4df5-b7d3-ba3ed3b4e633"
			config-ref="HTTP_Request_configuration_mongo"
			path="${mongo-sapi.getCatalog.path}">
			<http:headers><![CDATA[#[output application/java
---
{
	"client_secret" :  p('mongo-sapi.client_secret'),
	"client_id" :  p('mongo-sapi.client_id')
}]]]></http:headers>
			<http:uri-params><![CDATA[#[output application/java
---
{
	"id" : vars.id
}]]]></http:uri-params>
		</http:request>
	</sub-flow>
	<sub-flow name="get-promociones-client" doc:id="c8289979-a6ed-4e97-a2ff-44a9c36903ce" >
		<http:request method="GET" doc:name="Get promociones" doc:id="99b377bd-d90c-4152-a92e-6b0d6f308857" config-ref="HTTP_Request_configuration_mongo" path="${mongo-sapi.getPromociones.path}" >
			<http:headers ><![CDATA[#[output application/java
---
{
	"client_secret" :  p('mongo-sapi.client_secret'),
	"client_id" :  p('mongo-sapi.client_id'),
	"systemId": vars.systemId default "MAYORISTAS",
	"processName": vars.processName default "Promociones",
	"name": "",
	"source": "",
	"X-CORRELATION-ID": correlationId
}]]]></http:headers>
		</http:request>
	</sub-flow>
	<sub-flow name="get-promXpkg-client" doc:id="c2f54b78-aaaf-4f3f-9bc2-a5c44cee9d7a" >
		<http:request method="GET" doc:name="Get promXpkg" doc:id="2a450c85-127a-4ca2-bae2-d125f88dc56a" config-ref="HTTP_Request_configuration_mongo" path="${mongo-sapi.getPromXPkg.path}" >
			<http:headers ><![CDATA[#[output application/java
---
{
	"client_secret" :  p('mongo-sapi.client_secret'),
	"client_id" :  p('mongo-sapi.client_id'),
	"systemId": vars.systemId default "MAYORISTAS",
	"processName": vars.processName default "Promociones",
	"name": "",
	"source": "",
	"X-CORRELATION-ID": correlationId
}]]]></http:headers>
		</http:request>
	</sub-flow>
	<sub-flow name="get-active-service" doc:id="a22429fb-23fd-4970-98f2-6ecb8787d6af" >
		<http:request method="GET" doc:name="Request to get active service" doc:id="f2b9187a-e4cf-4692-ae9f-b64e80f8afcb" config-ref="HTTP_Request_configuration_mongo" path="${mongo-sapi.getActiveService.path}" >
			<http:headers ><![CDATA[#[output application/java
---
{
	"client_id" : p('mongo-sapi-services.client_id'),
	"client_secret" : p('mongo-sapi-services.client_secret'),
	"systemId": vars.systemId default "MAYORISTAS",
	"processName": vars.processName default "Promociones",
	"name": "",
	"source": "",
	"X-CORRELATION-ID": correlationId
}]]]></http:headers>
			<http:uri-params ><![CDATA[#[output application/java
---
{
	"integrationId" : vars.connectionNumber
}]]]></http:uri-params>
		</http:request>
	</sub-flow>
	<sub-flow name="get-order-by-ctaFact" doc:id="c909807e-341f-4985-83c2-bc4cb3f25fcc" >
		<http:request method="GET" doc:name="Request to get order by fact account" doc:id="e6fabac3-744d-4058-a266-4bd228e2f728" config-ref="HTTP_Request_configuration_mongo" path="${mongo-sapi.getOrderByCtaFact.path}" >
			<http:headers ><![CDATA[#[output application/java
---
{
	"client_id" : p('mongo-sapi-services.client_id'),
	"client_secret" : p('mongo-sapi-services.client_secret'),
	"systemId": vars.systemId default "MAYORISTAS",
	"processName": vars.processName default "Promociones",
	"name": "",
	"source": "",
	"X-CORRELATION-ID": correlationId
}]]]></http:headers>
			<http:uri-params ><![CDATA[#[output application/java
---
{
	"cuentaFacturacion" : vars.ctaFact
}]]]></http:uri-params>
			<http:query-params ><![CDATA[#[output application/java
---
{
	"type" : "Mobile"
}]]]></http:query-params>
		</http:request>
	</sub-flow>
	<sub-flow name="post-pkg-by-promotion" doc:id="41bdd862-5399-4b25-b5b0-f24062d6d1fa" >
		<http:request method="POST" doc:name="Request to log applyed promotions" doc:id="623f8309-fb77-46e7-8a87-21444a02c174" config-ref="HTTP_Request_configuration_mongo" path="${mongo-sapi.postPkgByPromotion.path}" >
			<http:headers ><![CDATA[#[output application/java
---
{
	"client_id" : p('mongo-sapi-services.client_id'),
	"client_secret" : p('mongo-sapi-services.client_secret'),
	"systemId": vars.systemId default "MAYORISTAS",
	"processName": vars.processName default "Promociones",
	"name": "",
	"source": "",
	"X-CORRELATION-ID": correlationId
}]]]></http:headers>
		</http:request>
	</sub-flow>
	<sub-flow name="post-send-message-enrutador-datos" doc:id="91b3c1bd-6ef3-4f73-b4b2-d81cccc44c5f" >
		<http:request method="POST" doc:name="Send Message" doc:id="1e442274-757a-47fa-8db8-3f08b317d886" path="${mongo-sapi.enrutadorDatos.path}" config-ref="HTTP_Request_configuration_mongo">
			<http:headers ><![CDATA[#[output application/java
---
{
	"client_id" : p('mongo-sapi-services.client_id'),
	"client_secret" : p('mongo-sapi-services.client_secret'),
	"systemId": vars.systemId default "MAYORISTAS"
}]]]></http:headers>
		</http:request>
	</sub-flow>
	<sub-flow name="get-send-message-enrutador-datos" doc:id="d0066ea8-2807-4ce9-af22-95ede054848b" >
		<http:request method="GET" doc:name="Request all pending messages" doc:id="a7c263a9-376c-4746-a001-41e26d1c1b86" config-ref="HTTP_Request_configuration_mongo" path="${mongo-sapi.enrutadorDatos.path}">
			<http:headers ><![CDATA[#[output application/java
---
{
	"client_id" : p('mongo-sapi-services.client_id'),
	"client_secret" : p('mongo-sapi-services.client_secret'),
	"systemId": vars.systemId default "MAYORISTAS"
}]]]></http:headers>
		</http:request>
	</sub-flow>
	<sub-flow name="patch-send-message-enrutador-datos" doc:id="942b22ba-9e36-47c9-9467-cba06c308424" >
		<http:request method="PATCH" doc:name="Request to update state of message" doc:id="0fe3ba3d-88b3-40e9-bc2f-b1c42dc08904" path="${mongo-sapi.enrutadorDatos.path_patch}" config-ref="HTTP_Request_configuration_mongo">
			<http:headers ><![CDATA[#[output application/java
---
{
	"client_id" : p('mongo-sapi-services.client_id'),
	"client_secret" : p('mongo-sapi-services.client_secret'),
	"systemId": vars.systemId default "MAYORISTAS"
}]]]></http:headers>
			<http:uri-params ><![CDATA[#[output application/java
---
{
	"id" : vars.messageId
}]]]></http:uri-params>
		</http:request>
	</sub-flow>
	<sub-flow name="post-log-message-client" doc:id="0a6b9d94-2443-425c-ba6a-0e6033ec03f9">
		<http:request method="POST" doc:name="Request to Post of Log Message" doc:id="b699fc8d-1da5-4a51-8175-a9f9bad3adae" config-ref="HTTP_Request_configuration_mongo" path="${mongo-sapi.logMessages.path}">
			<http:headers><![CDATA[#[output application/java
---
{
	"client_id" : p('mongo-sapi-services.client_id'),
	"client_secret" : p('mongo-sapi-services.client_secret'),
	"systemId": vars.systemId default "MAYORISTAS"
}]]]></http:headers>
		</http:request>
	</sub-flow>
	<sub-flow name="patch-log-historial-estado-client" doc:id="7e64775a-de36-4620-91c4-7087b1e5aab7" >
		<http:request method="PATCH" doc:name="Request to patch log in historial estado" doc:id="c652c62c-9079-40e0-91cb-28ae390b2dcf" config-ref="HTTP_Request_configuration_mongo" path="${mongo-sapi.logMessages.path}">
			<http:headers ><![CDATA[#[output application/java
---
{
	"client_id" : p('mongo-sapi-services.client_id'),
	"client_secret" : p('mongo-sapi-services.client_secret'),
	"systemId": vars.systemId default "MAYORISTAS"
}]]]></http:headers>
		</http:request>
	</sub-flow>
	<sub-flow name="patch-log-info-historial-estado-client" doc:id="4d725d34-cdd1-46bb-9b0d-747fd93ad139" >
		<http:request method="PATCH" doc:name="Request to patch fields msg sent in log in historial estado" doc:id="8fbd26fc-b02b-4ac6-b6fb-239c56df08e1" config-ref="HTTP_Request_configuration_mongo" path="${mongo-sapi.logMessages.sentInfo}">
			<http:headers ><![CDATA[#[output application/java
---
{
	"client_id" : p('mongo-sapi-services.client_id'),
	"client_secret" : p('mongo-sapi-services.client_secret'),
	"systemId": vars.systemId default "MAYORISTAS"
}]]]></http:headers>
		</http:request>
	</sub-flow>
	<sub-flow name="get-log-historial-estado-client" doc:id="202687be-81e6-437b-b09d-edd874b7fa20" >
		<http:request method="GET" doc:name="Request to get log in historial estado" doc:id="a3d13536-cbf4-4457-8d2a-c1eaab20f74c" config-ref="HTTP_Request_configuration_mongo" path="${mongo-sapi.logMessages.path}">
			<http:headers ><![CDATA[#[output application/java
---
{
	"client_id" : p('mongo-sapi-services.client_id'),
	"client_secret" : p('mongo-sapi-services.client_secret'),
	"systemId": vars.systemId default "MAYORISTAS"
}]]]></http:headers>
			<http:query-params ><![CDATA[#[{ messageId: vars.messageId }]]]></http:query-params>
		</http:request>
	</sub-flow>
	<sub-flow name="get-message-status" doc:id="d8bd479d-0d09-41d4-9024-e35b947521d9" >
		<http:request method="GET" doc:name="Request to Get Message Status" doc:id="2942409e-674e-41e0-bbdf-327659139657" config-ref="HTTP_Request_configuration_mongo" path="${mongo-sapi.logMessages.path}">
			<http:headers ><![CDATA[#[output application/java
---
{
	"client_id" : p('mongo-sapi-services.client_id'),
	"client_secret" : p('mongo-sapi-services.client_secret'),
	"systemId": vars.systemId default "MAYORISTAS"
}]]]></http:headers>
			<http:query-params ><![CDATA[#[{
	messageId: vars.id
}]]]></http:query-params>
		</http:request>
	</sub-flow>
	<sub-flow name="delete-processed-messages-clientSub_Flow" doc:id="816a2362-06c1-4c82-9fbc-b7e0f00c2a4c" >
		<http:request method="DELETE" doc:name="Request to Delete Messages Processed" doc:id="bae4910c-657b-4736-bc42-0cff7ba1d748" config-ref="HTTP_Request_configuration_mongo" path="${mongo-sapi.enrutadorDatos.path}">
			<http:headers ><![CDATA[#[output application/java
---
{
	"client_id" : p('mongo-sapi-services.client_id'),
	"client_secret" : p('mongo-sapi-services.client_secret'),
	"systemId": vars.systemId default "MAYORISTAS"
}]]]></http:headers>
			<http:query-params ><![CDATA[#[output application/java
---
{
	"otpTime" : payload.otpTime,
	"regulatoryTime" : payload.regulatoryTime,
	"campaignTime" : payload.campaignTime,
}]]]></http:query-params>
		</http:request>
	</sub-flow>
</mule>
