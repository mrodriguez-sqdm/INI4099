<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="billingAccount-get-orchestadorSub_Flow" doc:id="2fddc350-f580-4434-9c14-965acde11e8a" >
		<set-variable value="#[attributes.queryParams]" doc:name="Save Parameters" doc:id="63338b6e-a6d6-44b3-99a4-d611d383e796" variableName="parameters" />
		<set-variable value="#[attributes.headers]" doc:name="Save headers" doc:id="2cdd8db1-e28b-4385-823b-d9406d91742f" variableName="headers" />
		<flow-ref doc:name="Flow Reference" doc:id="96c605eb-b217-413c-a3df-6743ff3739d5" name="get-billingAccount-mongo-db-sapi-clientSub_Flow"/>
		<ee:transform doc:name="Transform Message" doc:id="0976b065-b017-40b7-9212-c80064a20461" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
var nowDate = (now() as String {format: "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'"})

---
{
    codeResponse: payload.codigo,
    responseMessage: "The request was successful",
    billingData: payload.datos_facturacion map (item) -> {
        id: item."_id"."\$oid",
        billingCycle: item.Ciclo_Facturacion default "",
        city: item.Ciudad default "",
        email: item.Correo_Electronico default "",
        billingAccount: item.Cuenta_Facturacion default "",
        department: item.Departamento default "",
        address: item.Direccion default "",
        status: item.Estado default "",
        billingCutoffDate: nowDate,
        frequency: item.Frecuencia default "",
        documentNumber: item.Numero_Identificacion default "",
        country: item.Pais default "",
        documentType: item.Tipo_Documento default "",
        invoiceDeliveryType: item.Tipo_Entrega_Factura default "",
        invoiceType: item.Tipo_Factura default "",
        creationUser: item.Usuario_Creador default "",
        arrearsHeight: item.Altura_Mora default "",
        neighborhood: item.Barrio default "",
        chargingCycle: item.Ciclo_Charging default "",
        chargingCycleCode: item.Codigo_Ciclo_Charging default "",
        parentBillingAccount: item.Cuenta_Padre_Facturacion default "",
        stratum: item.Estrato default "",
        updateDate: nowDate,
        creationDate: nowDate,
        modificationDate: nowDate,
        billingAccountId: "",
        salesforceBillingAccountId: "",
        billingAddressId: 0,
        relatedOrderId: "",
        taxes: item.Impuestos default "",
        locality: item.Localidad default "",
        market: item.Mercado default "",
        modifiedMDM: "",
        recurrentPayment: item.Pago_Rec default [] map (p) -> {
            id: p."_id"."\$oid",
            extractorUpdate: "",
            creationDate: nowDate,
            modificationDate: nowDate,
            paymentMethodId: p.Id_Medio_Pago default "",
            isRecurrentPayment: p.Is_Pago_Recurrente default false,
            creationUser: "",
            modificationUser: ""
        },
        invoiceSupport: item.Soporte_Factura default "",
        paymentType: item.Tipo_Pago default "",
        modificationUser: item.Usuario_Modificador default ""
    }
}
]]></ee:set-payload>
			</ee:message>
		</ee:transform>
	</sub-flow>
</mule>
