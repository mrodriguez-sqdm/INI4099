#%RAML 1.0
title: common-xapi-services
version: v1
baseUri:  https://common-xapi-services-{env}.us-e2.cloudhub.io/{version}
description: The API supports the ability to send requests to create a new trouble ticket specifying the nature and severity of the trouble or issue as well as all necessary related information. 
protocols:
  - HTTPS

types:
  error-response: !include datatypes/response/error.raml
  geographicAddress: !include datatypes/response/geographicAddress.raml
  normalize: !include datatypes/response/normalizeResponse.raml
  geocodificate: !include datatypes/response/geocodificarResponse.raml

traits:
  tibcoHeaders: !include exchange_module/35a39a92-efa9-49b6-8f13-d66508fd2f35/tibcorequestheaders/1.0.6/tibcorequestheaders.raml

mediaType: 
  - application/json

securitySchemes:
  etb_oauth_2_0: !include exchange_module/35a39a92-efa9-49b6-8f13-d66508fd2f35/etb-oauth-20/1.0.1/etb-oauth-20.raml


/troubleTicket:
    get:
      is:
          - tibcoHeaders
      securedBy: [etb_oauth_2_0]
      displayName: Get troubleTicket
      description: get pqr data
      queryParameters:
        ORIGIN:
          type: string
          example: "WHATSAPP"
          description: "Parameter that allows the origin of the request to be identified"
        CUSTOMER_ID:
          type: string
          example: "12552454"
          description: "Customer identification number can be ID card or tax ID number"
          required: false
        CUSTOMER_ID_TYPE:
          type: string
          enum: ["CC","CE","PASAPORTE","NIT","RUT","TI"]
          example: "CC"
          description: "Type of customer identification document "
          required: false
        FILTERS:
          type: string
          example: "Phone:542545454;AccountNumber:12452145"
          description: "String used to apply filters to the query (follow example), separate the filter type and its value with a colon, and separate the number of filters with a semicolon."
          required: false
        CUN:
          type: string
          example: "421544"
          description: "CUN number of the PQR"
          required: false
        PQR_ID:
          type: string
          example: "421544"
          description: "CUN number of the PQR"
          required: false
        BILLING_ACCOUNT:
          type: string
          example: "421544"
          description: "Billing account number to be consulted"
          required: false
        PHONE:
          type: string
          example: "421544"
          description: "Connection number to be consulted"
          required: false
        LIMIT:
          type: number
          description: "Limit on orders to display"
          required: false
        OFFSET:
          type: string
          description: "used to organize information and establish a logical order"
          required: false
      responses:
          200:
            body:
              application/json:
                type: !include /datatypes/response/get-pqr.raml
                example: !include /examples/response/get-pqr.json
          400:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-400.json
          401:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-401.json
          404:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-404.json
          500:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-500.json
    post:
      is:
          - tibcoHeaders
      securedBy: [etb_oauth_2_0]
      displayName: troubleTicket
      description: create pqr
      queryParameters:
        ORIGIN:
          type: string
          example: "WHATSAPP"
          description: "Parameter that allows the origin of the request to be identified"
      body:
        application/json:
          type: !include /datatypes/request/create-pqr.raml
          example: !include /examples/request/create-pqr.json
      responses:
          200:
            body:
              application/json:
                type: !include /datatypes/response/create-pqr.raml
          400:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-400.json
          401:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-401.json
          404:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-404.json
          500:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-500.json
    /{id}:
      patch:
        is:
          - tibcoHeaders
        securedBy: [etb_oauth_2_0]
        displayName: troubleTicketUpdate
        description: update pqr client
        queryParameters:
          ORIGIN:
            type: string
            example: "WHATSAPP"
            description: "Parameter that allows the origin of the request to be identified"
        body:
          application/json:
            type: !include /datatypes/request/update-pqr.raml
            example: !include /examples/request/update-pqr.json
        responses:
          200:
            body:
              application/json:
                type: !include /datatypes/response/update-pqr.raml
          400:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-400.json
          401:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-401.json
          404:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-404.json
          500:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-500.json
/permission:
  post:
      is:
          - tibcoHeaders
      securedBy: [etb_oauth_2_0]
      displayName: authenticateUser
      description: user authentication in the system
      queryParameters:
        ORIGIN:
          type: string
          example: "WHATSAPP"
          description: "Parameter that allows the origin of the request to be identified"
      body:
        application/json:
          type: !include /datatypes/request/authenticate-user.raml
          example: !include /examples/request/authenticate-user.json
      responses:
          200:
            body:
              application/json:
                type: !include /datatypes/response/authenticate-user.raml
                example: !include /examples/response/authenticate-user.json
          400:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-400.json
          401:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-401.json
          404:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-404.json
          500:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-500.json
/audit:
  post:
      is:
          - tibcoHeaders
      #securedBy: [etb_oauth_2_0]
      displayName: audits
      description: Create DIJIN audit
      body:
        application/json:
          type: !include /datatypes/request/create-audit.raml
          example: !include /examples/request/create-audit.json
      responses:
          200:
            body:
              application/json:
                type: !include /datatypes/response/create-audit.raml
                example: !include /examples/response/create-audit.json
          400:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-400.json
          401:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-401.json
          404:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-404.json
          500:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-500.json
/normalizeAddress:
  is:
    - tibcoHeaders
  #securedBy: [etb_oauth_2_0]
  displayName: normalizeAddress
  description: Get normalized address
  get:
    description: |
      Permite consultar direcciones vecinas luego de normalizar y georreferenciar, aplicando manejo de mensajes 
      de acuerdo con el estándar TMF673 v4
    queryParameters:
      address:
        type: string
        required: true
        description: Dirección a estandarizar
        example: "Diagonal  159B 14a 40 int 21"
      municipalityCod:
        type: string
        required: true
        description: Código de Municipio asociado a la dirección
        example: "11001"
      departamentCod:
        type: string
        required: false
        description: Código de departamento asociado a la dirección (opcional)
        example: "11"
      vNormalizador:
        type: string
        required: false
        enum: ["CATASTRO", "SISEXT"]
        description: |
          **?? PARÁMETRO IGNORADO - NO UTILIZAR ??**
          
          Este parámetro existe por compatibilidad pero NO se utiliza en el código.
          El sistema determina automáticamente el normalizador a usar según:
          
          1. **Variable de Entorno**: p('normalizador.tipo') desde CloudHub Properties
          2. **Municipio**: Si municipalityCod=11001 (Bogotá) y normalizador.tipo=CATASTRO ? usa API Catastro
          3. **Fallback**: Si Catastro falla y normalizador.fallback=true ? usa SISEXT
          4. **Otros Municipios**: Siempre usa SISEXT (smallworld-sapi)
          
          **Configuración en CloudHub Properties:**
          - normalizador.tipo = "CATASTRO" | "SISEXT"
          - normalizador.fallback = true | false
          
          **NO envíe este parámetro en el request.**
        example: "CATASTRO"
    responses:
      200:
        body:
          application/json:
              type: normalize[]
              example: !include examples/response/normalizeResponse.json
      400:
        body:
          application/json:
            type: error-response
            example: !include examples/response/error-400.json
      401:
        body:
          application/json:
            type: error-response
            example: !include examples/response/error-401.json
      404:
        body:
          application/json:
            type: error-response
            example: !include examples/response/error-404.json
      500:
        body:
          application/json:
            type: error-response
            example: !include examples/response/error-500.json
/geographicCoverage:
  is:
    - tibcoHeaders
  #securedBy: [etb_oauth_2_0]
  displayName: addressGeographicCoverage
  description: Get address coverage using latitude and longitude coordinates
  get:
    description: |
      Permite consultar la cobertura usando coordenadas de latitud y longitud TMF675 v4
    queryParameters:
      latitude:
        type: number
        required: true
        description: Latitud de la ubicación
        example: 4.671486484
      longitude:
        type: number
        required: true
        description: Longitud de la ubicación
        example: -74.06268689
    responses:
      200:
        body:
          application/json:
            type: !include datatypes/response/geographicCoverageResponse.raml
            example: !include examples/response/geographicCoverageResponse.json
      400:
        body:
          application/json:
            type: error-response
            example: !include examples/response/error-400.json
      401:
        body:
          application/json:
            type: error-response
            example: !include examples/response/error-401.json
      404:
        body:
          application/json:
            type: error-response
            example: !include examples/response/error-404.json
      500:
        body:
          application/json:
            type: error-response
            example: !include examples/response/error-500.json
/geographicAddressManagement:              
  /coverage:
    is:
      - tibcoHeaders
    #securedBy: [etb_oauth_2_0]
    displayName: coverage
    description: Returns information about coverage using latitude and longitude coordinates, Obtain coverage with latitude and longitude
    get:
      description: |
        Permite consultar la cobertura usando coordenadas de latitud y longitud
      queryParameters:
        latitude:
          type: number
          required: true
          description: Latitud de la ubicación
          example: 4.671486484
        longitude:
          type: number
          required: true
          description: Longitud de la ubicación
          example: -74.06268689
      responses:
        200:
          body:
            application/json:
              type: !include datatypes/response/coverageResponse.raml
              example: !include examples/response/coverageResponse.json
        400:
          body:
            application/json:
              type: error-response
              example: !include examples/response/error-400.json
        401:
          body:
            application/json:
              type: error-response
              example: !include examples/response/error-401.json
        404:
          body:
            application/json:
              type: error-response
              example: !include examples/response/error-404.json
        500:
          body:
            application/json:
              type: error-response
              example: !include examples/response/error-500.json
  /geocodificate:
    is:
      - tibcoHeaders
    #securedBy: [etb_oauth_2_0]
    displayName: geocodificate
    description: Geocodifies an address using the Common PAPI to get coordinates and additional location information, Geocodify address using Common PAPI
    get:
      description: |
        Permite geocodificar una dirección usando Common PAPI
      queryParameters:
        address:
          type: string
          required: true
          description: Dirección a geocodificar
          example: "Carrera 11 67A 40 SUR"
      responses:
        200:
          body:
            application/json:
              type: geocodificate
              example: !include examples/response/geocodificarResponse.json
        400:
          body:
            application/json:
              type: error-response
              example: !include examples/response/error-400.json
        401:
          body:
            application/json:
              type: error-response
              example: !include examples/response/error-401.json
        404:
          body:
            application/json:
              type: error-response
              example: !include examples/response/error-404.json
        500:
          body:
            application/json:
              type: error-response
              example: !include examples/response/error-500.json
  /addressComplementResolver:
    is:
      - tibcoHeaders
    #securedBy: [etb_oauth_2_0]
    displayName: addressComplement
    description: Get address complements
    get:
      description: |
        Retornar información de complementos asociados a una dirección actual
      queryParameters:
        address:
          type: string
          required: true
          description: Dirección actual
          example: "AK 45 108A 50"
        cityId:
          type: number
          required: true
          description: Codigo de municipio o ciudad
          example: 11001
        limit:
          type: number
          required: false
          description: Limite de complementos consultados
          example: 10
      responses:
        200:
          body:
            application/json:
              type: geographicAddress
              example: !include examples/response/geographicAddress-complements.json
        400:
          body:
            application/json:
              type: error-response
              example: !include examples/response/error-400.json
        401:
          body:
            application/json:
              type: error-response
              example: !include examples/response/error-401.json
        404:
          body:
            application/json:
              type: error-response
              example: !include examples/response/error-404.json
        500:
          body:
            application/json:
              type: error-response
              example: !include examples/response/error-500.json
/comunicationMessage:   
  post:
      is:
          - tibcoHeaders
      securedBy: [etb_oauth_2_0]
      displayName: Notification User
      description: Sends notification about a procedure; receives customer and procedure data, returns shipment status.
      queryParameters:
        ORIGIN:
          type: string
          example: "WHATSAPP"
          description: "Parameter that allows the origin of the request to be identified"
      body:
        application/json:
          type: !include /datatypes/request/comunication-message.raml
          example: !include /examples/request/comunication-message.json
      responses:
          200:
            body:
              application/json:
                type: !include /datatypes/response/comunication-message.raml
                example: !include /examples/response/comunication-message.json
          400:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-400.json
          401:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-401.json
          404:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-404.json
          500:
            body:
              application/json:
                type: !include /datatypes/response/error.raml
                example: !include /examples/response/error-500.json