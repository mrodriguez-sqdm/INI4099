<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="initial-loggin-OMtransaction_Sub_Flow" doc:id="8494bf17-1509-4505-aa3b-19716bd9713c" >
<ee:transform doc:name="Set Accepted StatusCode" doc:id="b3070cf6-103d-4030-8463-4895a0cfbbab" >
			<ee:message >
			</ee:message>
			<ee:variables >
				<ee:set-variable variableName="httpStatus" ><![CDATA[202]]></ee:set-variable>
				<ee:set-variable variableName="systemId" ><![CDATA["TRANSACCCIONES_OM"]]></ee:set-variable>
			
</ee:variables>
		</ee:transform>
		<flow-ref doc:name="Flow Reference" doc:id="63c0b20f-50df-49fe-af23-7653fbb44227" name="loggin-client-call"/>
	
</sub-flow>
	<sub-flow name="process-loggin-OMtransaction_Sub_Flow1" doc:id="50da75d1-915d-4d4e-89f2-cffffe2509ee" >
		<ee:transform doc:name="Set Accepted StatusCode" doc:id="7bffd314-2984-4827-acfc-239278acffa2" >
			<ee:message />
			<ee:variables >
				<ee:set-variable variableName="httpStatus" ><![CDATA[206]]></ee:set-variable>
				<ee:set-variable variableName="systemId" ><![CDATA["TRANSACCCIONES_OM"]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<flow-ref doc:name="Flow Reference" doc:id="04e8c902-173b-4fb8-8138-3d36e789e4e5" name="loggin-client-call"/>
	</sub-flow>
	<sub-flow name="final-loggin-OMtransaction_Sub_Flow2" doc:id="b6849ac8-0722-4236-9e7b-b6a39b8c968d" >
		<ee:transform doc:name="Set Accepted StatusCode" doc:id="4fdb9241-5b68-4b6f-b14e-28e26aecbc2e">
			<ee:message />
			<ee:variables>
				<ee:set-variable variableName="httpStatus"><![CDATA[201]]></ee:set-variable>
				<ee:set-variable variableName="systemId"><![CDATA["TRANSACCCIONES_OM"]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<flow-ref doc:name="Flow Reference" doc:id="191836ce-05ab-4d24-b2e1-0d57ff5058e1" name="loggin-client-call"/>
	</sub-flow>
	<sub-flow name="loggin-client-call" doc:id="1a0ec286-cfbe-4d7c-b2bd-913ab985b28d" >
		<ee:transform doc:name="Transform Message" doc:id="36b972e2-69a8-4c45-b3f7-34bca301d0e6" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
var statusCode = if(!isEmpty(vars.httpStatus)) vars.httpStatus as String else if(isEmpty(payload.overallStatusCode)) "201" else payload.overallStatusCode
var attr = if(attributes == null) vars.attributes else attributes
var transactionId = if(!isEmpty(vars.headers)) vars.headers."x-correlation-id" else if (!isEmpty(attributes.headers."x-correlation-id")) attributes.headers."x-correlation-id" else correlationId
var host = if(isEmpty(attributes.remoteAddress)) vars.attributes.remoteAddress else attributes.remoteAddress
---
{
  transactionId: transactionId default correlationId,
  correlation_id: correlationId,
  fecha_creacion: now() >> "America/Bogota",
  fecha: now() as String {format: "yyyyMMdd"} as Number,
  body_request: write(payload.^raw, "application/json") as String,
  attributes_request: write(payload, 'application/json') as String,
  http_code: statusCode default "" as String,
  apiName: p('app.name') ,
  host: host default ""
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="Print Log" doc:id="935b3e15-fe5e-48c3-9485-f26c5fc5950b" message="#[payload]"/>
		<flow-ref doc:name="audits-client_log-audits-information" doc:id="5818e071-dbdd-45da-ace2-c7ec5a2d6884" name="post_log_audits-sapi-clientSub_Flow" />
		<logger level="INFO" doc:name="Logger" doc:id="ce74012d-3a3b-4c56-945b-6a6f9427509a" />
	</sub-flow>
	<sub-flow name="initial-loggin-migration_Sub_Flow" doc:id="69407fa1-fc5f-40d7-b3e2-3cdef7b797e1" >
		<ee:transform doc:name="Set Accepted StatusCode" doc:id="34d8344d-1cf8-438e-901c-836e63a113be" >
			<ee:message />
			<ee:variables >
				<ee:set-variable variableName="httpStatus" ><![CDATA[202]]></ee:set-variable>
				<ee:set-variable variableName="systemId" ><![CDATA["MIGRACION"]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<flow-ref doc:name="Flow Reference" doc:id="65fa4d94-4215-4bca-a869-d7d7d8a1682e" name="loggin-client-call" />
	</sub-flow>
	<sub-flow name="process-loggin-migration_Sub_Flow" doc:id="a1060bab-61af-4da4-849b-e22df4856871" >
		<ee:transform doc:name="Set Accepted StatusCode" doc:id="c2c39f8c-8744-4712-8c8f-a5e25cc63f6b" >
			<ee:message />
			<ee:variables >
				<ee:set-variable variableName="httpStatus" ><![CDATA[206]]></ee:set-variable>
				<ee:set-variable variableName="systemId" ><![CDATA["MIGRACION"]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<flow-ref doc:name="Flow Reference" doc:id="58f7b444-6e7e-4206-afc3-0fb4c6d62c07" name="loggin-client-call" />
	</sub-flow>
	<sub-flow name="final-loggin-migration_Sub_Flow" doc:id="17881fcb-b7b0-44b8-9a7a-ba9caf2c25eb" >
		<ee:transform doc:name="Set Accepted StatusCode" doc:id="85f38d40-87dd-4b10-9648-121687e1e1cc">
			<ee:message />
			<ee:variables>
				<ee:set-variable variableName="httpStatus"><![CDATA[201]]></ee:set-variable>
				<ee:set-variable variableName="systemId"><![CDATA["MIGRACION"]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<flow-ref doc:name="Flow Reference" doc:id="53e58959-f078-4e54-8ec2-d7d35156ad90" name="loggin-client-call" />
	</sub-flow>
</mule>
