<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="parametersRetention-get-orchestadorSub_Flow" doc:id="2fddc350-f580-4434-9c14-965acde11e8a" >
		<set-variable value="#[attributes.queryParams]" doc:name="Save Parameters" doc:id="33a66b6e-0f2f-489d-8b64-d877934adec5" variableName="parameters" />
		<set-variable value="#[attributes.headers]" doc:name="Save headers" doc:id="2cdd8db1-e28b-4385-823b-d9406d91742f" variableName="headers" />
		<choice doc:name="Choice" doc:id="446f3a7d-e860-45f4-b25d-bb4dee0a6c67" >
			<when expression="vars.parameters.OPERATION == 'PARAMETROS_RETENCION'">
				<set-variable value='#[%dw 2.0&#10;output application/java&#10;---&#10;if (vars.parameters.FILTERS == "TypeParameter:Motivos;") 35&#10;else if (vars.parameters.FILTERS == "TypeParameter:SubMotivos;") 36&#10;else if (vars.parameters.FILTERS == "TypeParameter:Motivos_SubMotivos;") 37&#10;else null]' doc:name="Set Variable" doc:id="39ce9c2f-229d-45b0-bb1f-124d3ecf0e1a" variableName="parameterType"/>
				<flow-ref doc:name="Flow Reference" doc:id="e3a8baf7-970e-44d7-b625-2150340d478e" name="get-parametersRetention-mongo-db-sapi-clientSub_Flow" />
				<ee:transform doc:name="Transform Message" doc:id="0976b065-b017-40b7-9212-c80064a20461">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{
    codeResponse: payload.codigo,
    messageResponse: "consulta realizadaexitosamente",
    utilitys: {
        parameters: payload.parametros_retencion map (p) -> {
            id: p."_id"."\$oid",
            creationDate: p."Fecha_Creacion"."\$date",
            modificationDate: p."Fecha_Modificacion"."\$date",
            modifiedByUser: p."Usuario_Modificacion",
            createdByUser: p."Usuario_Creacion",
            extractorUpdate: p."Actualizacion_Extractor",
            parameterType: p."Tipo_Parametro",
            name: p."Nombre",
            values: p."Valores" map (v) -> {
                code: v."Codigo",
                status: v."Estado",
                value: v."Valor",
                attributeClass: v."ClaseAtributo",
                attributeType: v."TipoAtributo",
                relations: v."Relacion" map (r) -> {
                    code: r."Codigo",
                    status: r."Estado",
                    name: r."Nombre" default null,
                    value: r."Valor",
                    attributeClass: r."ClaseAtributo",
                    attributeType: r."TipoAtributo",
                    relations: r."Relacion",
                    rules: r."Reglas",
                    levels: r."Niveles"
                },
                rules: v."Reglas",
                levels: v."Niveles"
            },
            steps: p."Pasos",
            actions: p."Acciones",
            reasonSteps: p."MotivosPasos",
            ruleSteps: p."ReglasPasos"
        },
        operators: [],
        bussinesdays: []
    }
}
]]></ee:set-payload>
			</ee:message>
		</ee:transform>
			</when>
			<otherwise >
				<ee:transform doc:name="Transform Message" doc:id="b7bb2b7f-822b-445a-a70a-fe09249c7dcb" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
  codeResponse: 500 ,
  messageResponse: "OperaciÃ³n no definida"
}]]></ee:set-payload>
					</ee:message>
				</ee:transform>
			</otherwise>
		</choice>
	</sub-flow>
</mule>
