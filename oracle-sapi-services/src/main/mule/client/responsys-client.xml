<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:http="http://www.mulesoft.org/schema/mule/http"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="Authenticate_responsys" doc:id="54215ed5-e8f0-4bf3-b818-8e8472994ebc" >
		<async doc:name="Async" doc:id="1399c1e1-616c-4207-bde3-89c316baad49" >
			<ee:transform doc:name="Set Payload" doc:id="ac6308c3-79ce-4805-896c-3613d2ebeee7">
				<ee:message>
					<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
vars.authBody default payload]]></ee:set-payload>
				</ee:message>
			</ee:transform>
			<flow-ref doc:name="Call logger before" doc:id="a2072ee1-c115-4e2f-a095-f37febc80e6d" name="loggin-client-call"/>
		</async>
		<http:request method="POST" doc:name="Call auth" doc:id="c97b0b16-b763-4be3-a371-52ee1797ee32" config-ref="HTTP_Request_configuration_responsys_auth" path="${responsys.auth.path}">
			<http:body ><![CDATA[#[vars.authBody]]]></http:body>
			<http:headers ><![CDATA[#[output application/java
---
{
	"Content-Type" : p('responsys.auth.content-type')
}]]]></http:headers>
		</http:request>
		<async doc:name="Async" doc:id="1449da5c-7467-430c-ae36-528cdd39c07e" >
			<flow-ref doc:name="Call logger after" doc:id="fda93ea6-92b5-46a0-ab49-3e503bf9af23" name="loggin-client-call"/>
		</async>
	</sub-flow>
	<sub-flow name="responsys-registerMember" doc:id="ec9d1d9d-8b50-4a86-b37b-4b84a8c544bb" >
		<async doc:name="Async" doc:id="f3532423-0c7b-44ef-b758-2c1ca306b53a" >
			<ee:transform doc:name="Set Payload" doc:id="073f24b3-259a-4871-af16-b77c784e340c">
				<ee:message>
					<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
vars.registerInput default payload]]></ee:set-payload>
				</ee:message>
			</ee:transform>
			<flow-ref doc:name="Call logger before" doc:id="6c465bd6-15b1-49b5-b3b4-50c143bcd7a6" name="loggin-client-call"/>
		</async>
		<http:request method="POST" doc:name="Call register" doc:id="066456d4-80b9-423b-be5d-6300af8e29e4" url="#[vars.authResponse.endPoint ++ p('responsys.registerPetition.basepath') ++ vars.inputPayload.addId]">
			<http:body ><![CDATA[#[vars.registerInput]]]></http:body>
			<http:headers><![CDATA[#[output application/java
---
{
	"Authorization" : vars.authResponse.authToken,
	"Content-Type" : p('responsys.registerPetition.content-type')
}]]]></http:headers>
		</http:request>
		<async doc:name="Async" doc:id="91472993-d399-4348-b179-5450f9c9f22e" >
			<flow-ref doc:name="Call logger after" doc:id="8799c907-dd86-4756-84d0-3cb8988959cd" name="loggin-client-call"/>
		</async>
	</sub-flow>
	<sub-flow name="responsys-fireTrigger" doc:id="acca67fd-d1cd-40de-8965-29e5d54de827" >
		<async doc:name="Async" doc:id="994eaf00-69ac-47bc-b158-34c0c391da92" >
			<flow-ref doc:name="Call logger before" doc:id="b8de4d41-f873-449d-9459-dff603d922ff" name="loggin-client-call"/>
		</async>
		<http:request method="POST" doc:name="Call trigger" doc:id="d0bd3a02-6c18-41b9-aa85-7695f9c375d8" url="#[vars.authResponse.endPoint ++ p('responsys.registerPetition.basepath') ++ vars.inputPayload.triggerId]">
			<http:headers ><![CDATA[#[output application/java
---
{
	"Authorization" : vars.authResponse.authToken,
	"Content-Type" : p('responsys.registerPetition.content-type')
}]]]></http:headers>
		</http:request>
		<async doc:name="Async" doc:id="ac194287-9b78-4def-9099-06e871b4c9d6" >
			<flow-ref doc:name="Call logger after" doc:id="aed077fe-d15f-46a5-98b4-30933c0e1c60" name="loggin-client-call"/>
		</async>
	</sub-flow>
</mule>