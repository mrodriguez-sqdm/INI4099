<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="get-resources-id-orchestratorSub_Flow" doc:id="21e2b453-2a38-4361-8f6a-1eba52cd4461" >
		<set-variable value="#[attributes.uriParams.id]" doc:name="id" doc:id="143cd221-3228-45c4-b108-3307f44880d2" variableName="id" />
		<ee:transform doc:name="Set typeParameter" doc:id="efe8ef34-03b2-489d-b79d-a9f623903ff7" >
			<ee:message />
			<ee:variables >
				<ee:set-variable variableName="typeParameter" ><![CDATA[%dw 2.0
output application/java
---
p('mongo-sapi-services.parameters.param')]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<flow-ref doc:name="Go to get parameter mongo client" doc:id="8df23cd6-8520-4738-986a-5928ea63f15e" name="get-parameters" target="get_parameters_resp" />
		<ee:transform doc:name="authString" doc:id="dd82f474-ea22-4452-8a1e-2965f04e044a" >
			<ee:message />
			<ee:variables >
				<ee:set-variable variableName="authString" ><![CDATA[%dw 2.0
import * from dw::core::Binaries
output application/json
var user = (vars.get_parameters_resp[0].Valores filter $.Codigo == p('oracle-ocs.syncOrder.user'))[0].Nombre
var company = (vars.get_parameters_resp[0].Valores filter $.Codigo == p('oracle-ocs.syncOrder.company'))[0].Nombre
var pass = (vars.get_parameters_resp[0].Valores filter $.Codigo == p('oracle-ocs.syncOrder.pass'))[0].Nombre
---
toBase64((user ++ "@" ++ company ++ ":" ++ pass) as Binary)]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<try doc:name="Try" doc:id="e4a9c780-4396-4d62-a16c-f5d109cbd756" >
			<flow-ref doc:name="Go to patch assurance order" doc:id="8a75c19b-7c6b-4876-9dda-5110630489a2" name="get-resources-id-clientSub_Flow" />
			<ee:transform doc:name="Set response" doc:id="bcbac450-5057-4a7e-8a36-3d5aa2b91932" >
				<ee:message >
					<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
				</ee:message>
				<ee:variables >
					<ee:set-variable variableName="httpStatus" ><![CDATA[200]]></ee:set-variable>
				</ee:variables>
			</ee:transform>
			<error-handler >
				<on-error-continue enableNotifications="true" logException="true" doc:name="On Error Continue" doc:id="eae3706f-22aa-41d5-92ea-f7af3aba90fe" >
					<ee:transform doc:name="Set error description" doc:id="654345e2-d0f5-492b-83ed-74ec79c59803" >
						<ee:message />
						<ee:variables >
							<ee:set-variable variableName="errorDescription" ><![CDATA[error.errorMessage.payload.detail]]></ee:set-variable>
							<ee:set-variable variableName="httpStatus" ><![CDATA[error.errorMessage.payload.status]]></ee:set-variable>
						</ee:variables>
					</ee:transform>
					<raise-error doc:name="Raise error" doc:id="499f73ed-caa7-4b1a-b808-6194e34d211f" type="CUSTOM:ERROR" description="#[vars.errorDescription]" />
				</on-error-continue>
			</error-handler>
		</try>
	</sub-flow>
</mule>
