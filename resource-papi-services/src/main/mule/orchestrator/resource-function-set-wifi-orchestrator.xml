<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="post-resource-function-set-wifi-orchestratorSub_Flow" doc:id="fd85c1aa-687f-4836-bf54-b6ba58066272" >
		<set-variable value="#[attributes.queryParams]" doc:name="Save Parameters" doc:id="a0b26c34-3b35-46bb-9e4f-348039e2f4a4" variableName="parameters" />
		<set-variable value="#[attributes.headers]" doc:name="Save headers" doc:id="1fac0bb0-00da-4c8c-ad2c-8838db876401" variableName="headers" />
		<ee:transform doc:name="build Payload BOT" doc:id="ce5ab183-7ab2-4617-8f4e-f2ce5a76e053">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{
  "WSRequestHeader": {
    "System": {
      "name": vars.headers.name,
      "correlationID": vars.headers."X-CORRELATION-ID",
      "processingServer": ""
    },
    "Property": []
  },
"WSRequestBody": {
    "Phone": payload.connectionNumber default "",
    "Password": payload.operation.password default "",
    "Network_Type": payload.operation.networkType default "",
    "Audit": {
      "Canal": vars.headers.name
    }
  }
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<flow-ref doc:name="Flow Reference" doc:id="f15591cf-11b1-4fd6-90e2-bef7486328f3" name="soporte1n-setwifinetworkpassword-bot-sapi-clientSub_Flow" />
		<set-variable value='#[if(payload.WSResponseHeader.Service.status == "FAIL" and payload.WSResponseHeader.Service.statusDetail[0].errorCode == "BOTERROR")&#10; 500&#10;else&#10; 200]' doc:name="Set Variable" doc:id="39ad270b-09e2-4bbc-a1a9-9a4853102a91" variableName="httpStatus" />
		<ee:transform doc:name="Transform Message" doc:id="2c6fe37e-05dc-4682-95e7-77122e00513e">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{
    codeResponse: vars.httpStatus as String,
    messageResponse: payload.WSResponseHeader.Service.statusDetail[0].errorMessage,
	detail: {
	 numberPqr: payload.WSResponseBody.Num_PQR default "",
     status: payload.WSResponseBody.Status default "",
     message: payload.WSResponseBody.Message default ""
  }
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
	</sub-flow>
</mule>
