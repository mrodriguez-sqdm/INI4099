<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:os="http://www.mulesoft.org/schema/mule/os"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/os http://www.mulesoft.org/schema/mule/os/current/mule-os.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="get-status-description-orchestrator" doc:id="ad107a16-61cd-4885-b7ee-ac4a84b98424" >
		<flow-ref doc:name="get-status-description-client" doc:id="a4fd652c-362a-4512-a484-541c11910571" name="get-status-description-clientSub_Flow"/>
		<choice doc:name="Choice" doc:id="63fb43fd-980e-4e26-9981-47f33fe081aa" >
			<when expression="#[!isEmpty(payload)]">
				<ee:transform doc:name="Transform Message" doc:id="41cb810e-4d2b-479e-a18d-888735744f8e">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
vars.InputPayload.status map (inputPayload,index) -> {
	status: inputPayload,
	description: payload.Estados[0] filter ($.Codigo==inputPayload)
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
				<ee:transform doc:name="Transform Message" doc:id="7691afd9-f994-4bb3-a24b-17f832fc3b80">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{ response: payload map (payload,index) ->{
	status: payload.status,
	description: payload.description[0].Nombre
	}
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
			</when>
			<otherwise >
				<ee:transform doc:name="Response error" doc:id="93f5ee48-9d79-4852-9a0a-5fca60787f98" >
					<ee:message >
						<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
{
  "status": 404,
  "code": "NOT_FOUND",
  "message": {
    "message": "There are no matching records"
  },
  "messageServer": "",
  "cause": [
    {
      "origin": app.name,
      "message": "org.mule.extension.http.api.request.validator.ResponseValidatorTypedException"
    }
  ]
}]]></ee:set-payload>
					</ee:message>
					<ee:variables >
						<ee:set-variable variableName="httpStatus" ><![CDATA[%dw 2.0
output application/java
---
404]]></ee:set-variable>
					</ee:variables>
				</ee:transform>
			</otherwise>
		</choice>
	</sub-flow>
</mule>
