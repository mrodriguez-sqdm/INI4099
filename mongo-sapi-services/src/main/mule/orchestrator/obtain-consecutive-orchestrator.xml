<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="obtain-consecutive-orchestratorSub_Flow" doc:id="b18419bb-6565-4898-9b84-60a439ed22b2" >
		<flow-ref doc:name="Go to Client" doc:id="f4459988-2570-4535-9c41-5f4a14801736" name="obtain-consecutive-clientSub_Flow" />
		<set-variable value="#[payload.secuencia[0] as Number as String {format:'000000'}]" doc:name="Consecutivo" doc:id="e8ac9817-17df-4605-be31-da233d9e3018" variableName="consecutivo" />
		<set-variable value="#[payload.prefijo[0]]" doc:name="Prefijo" doc:id="207c53fe-b5fd-4add-acd1-6d3697eaeb53" variableName="prefijo" />
		<ee:transform doc:name="Output Obtain Consecutive" doc:id="7f93c009-12cf-4812-b5cc-a5482fe2bff5">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
var resultadoMsg = if(vars.consecutivo == null) "Negativo" else "Positivo"
var descripcionMsg = if(vars.consecutivo == null) "No se encontro un consecutivo para ese tipo." else null
output application/json skipNullOn="everywhere"
---
{
	"tipo": vars.tipo,
	"consecutivo": vars.prefijo ++ vars.consecutivo,
	"resultado": resultadoMsg,
	"fecha": now(),
	"descripcion": descripcionMsg
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="Logger Output" doc:id="929b5670-1300-4e92-afef-0ba2490654c9" message="#[payload]" />
	</sub-flow>
</mule>
