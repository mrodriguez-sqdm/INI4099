<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="post-enrutador-datos-handlerSub_Flow" doc:id="5ec66056-f2d0-44d2-9813-a2551b20f020" >
		<set-variable value="#[payload]" doc:name="Original Payload" doc:id="16f4699c-236d-4142-a75e-d8a44571fd8d" variableName="originalPayload" />
		<set-variable value="#[payload.uuids]" doc:name="Set Variable UUIDS" doc:id="80d9d996-e1cd-4c70-a26b-af0c04e0e2ea" variableName="uuids" />
		<ee:transform doc:name="Prepare Documents Array" doc:id="ecdc6a81-af77-4e3e-9ace-c4e4bcc76db4">
			<ee:message>
				<ee:set-payload><![CDATA[%dw 2.0
output application/json
---
payload.message.destinations map (destination, index) -> {
  destination: destination,
  messageId: (vars.uuids default [])[index],
  message: vars.originalPayload.message.message,
  category: vars.originalPayload.message.category,
  customSendNumber: vars.originalPayload.message.customSenderNumber,
  createdAt: vars.originalPayload.createdAt,
  status: vars.originalPayload.status,
  priority: vars.originalPayload.priority
}]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<flow-ref doc:name="Go to Orchestrator" doc:id="99ded07e-d00f-4cee-a6c4-254fa28ac706" name="post-enrutador-datos-orchestratorSub_Flow"/>
	</sub-flow>
</mule>
