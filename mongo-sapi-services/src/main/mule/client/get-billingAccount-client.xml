<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:mongo="http://www.mulesoft.org/schema/mule/mongo" xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/mongo http://www.mulesoft.org/schema/mule/mongo/current/mule-mongo.xsd">
	<sub-flow name="get-billingAccount-clientSub_Flow" doc:id="920d14c4-8367-42e6-adcd-dafade854d55" >
		<async doc:name="Async" doc:id="583fd59d-bb76-493a-b3ba-ebf93430d60c" >
			<flow-ref doc:name="Call logger before" doc:id="9abb734c-d5a8-48bb-980b-6bd6422dd424" name="loggin-client-call"/>
		</async>
		<choice doc:name="Choice" doc:id="b431b420-fa9c-4897-a6d0-8bf905de5b2b" >
			<when expression="#[vars.ordenOM != null]">
				<mongo:find-documents collectionName="#[p('mongoDb.collectionCtaFact')]" fields="," doc:name="Obtain Billing Account by his ordenOM" doc:id="8f1763bc-0e28-436f-9032-f27020993399" config-ref="or_db_config" limit="#[1]">
			<mongo:query><![CDATA[#["{ 'ordenOM': '" ++ vars.ordenOM ++ "'}"]]]></mongo:query>
		</mongo:find-documents>
			</when>
			<otherwise >
				<mongo:find-documents collectionName="#[p('mongoDb.collectionCtaFact')]" fields="," doc:name="Obtain Billing Account by his idCuentaFacturacion" doc:id="67af8339-bd47-4522-94c0-0747ddc723a3" config-ref="or_db_config" limit="#[1]" >
					<mongo:query ><![CDATA[#["{ 'idCuentaFacturacion': '" ++ vars.idCuentaFacturacion ++ "'}"]]]></mongo:query>
				</mongo:find-documents>
			</otherwise>
		</choice>
		<async doc:name="Async" doc:id="8dca695e-a1ce-403a-97d7-a2e5fd859b42" >
			<flow-ref doc:name="Call logger after" doc:id="b13a5e76-1e3c-4e97-9ccc-bb6e7cd1dd1a" name="loggin-client-call"/>
		</async>
	</sub-flow>
</mule>
