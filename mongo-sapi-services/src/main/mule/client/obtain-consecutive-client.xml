<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:mongo="http://www.mulesoft.org/schema/mule/mongo" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd
http://www.mulesoft.org/schema/mule/mongo http://www.mulesoft.org/schema/mule/mongo/current/mule-mongo.xsd">
	<sub-flow name="obtain-consecutive-clientSub_Flow" doc:id="4e585e76-ba71-4396-8ae4-039318cae171" >
		<mongo:find-documents doc:name="Find Consecutive in Mongo" doc:id="9e9c29ed-684a-4a04-8103-00f6641f2802" config-ref="or_db_config" collectionName="${mongoDb.collectionConsecutivo}" fields="," limit="#[1]">
			<mongo:query><![CDATA[#["{ 'tipo': '" ++ vars.tipo ++ "'}"]]]></mongo:query>
			<mongo:sort-by><![CDATA[{"secuencia":"DESC"}]]></mongo:sort-by>
		</mongo:find-documents>
		<set-variable value="#[(payload[0].secuencia  + 1) as String]" doc:name="secuencePlusOne" doc:id="2977827e-0e1a-4152-b3b5-e2c9d4df8831" variableName="secuencePlusOne" />
		<mongo:update-documents collectionName="${mongoDb.collectionConsecutivo}" doc:name="Update Secuence" doc:id="be977426-8503-477d-aa73-b254de1c8825" config-ref="or_db_config" target="updateResult">
			<mongo:query><![CDATA[#["{ 'tipo': '" ++ vars.tipo ++ "'}"]]]></mongo:query>
			<mongo:content-to-update><![CDATA[#["{ 'secuencia': '" ++ vars.secuencePlusOne ++ "'}"]]]></mongo:content-to-update>
		</mongo:update-documents>
	</sub-flow>
</mule>
