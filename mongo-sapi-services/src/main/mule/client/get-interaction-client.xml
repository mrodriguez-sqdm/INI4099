<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:mongo="http://www.mulesoft.org/schema/mule/mongo"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/mongo http://www.mulesoft.org/schema/mule/mongo/current/mule-mongo.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="get-interaction-clientSub_Flow" doc:id="0b6c61ed-39ce-41cb-a620-1555f18cbd9d" >
		<async doc:name="Async" doc:id="58928cbe-811b-431c-b262-341a774d0268">
			<flow-ref doc:name="Call logger before" doc:id="2f5a0e4f-57d6-4e84-b2c0-baa141cb9150" name="loggin-client-call" />
		</async>
		<mongo:find-documents collectionName="${mongoDb-mdm.otiniciativas.collection-interaction-hcm}" doc:name="Find documents" doc:id="b3298d0a-b0ab-49b5-aac7-589970926c34" config-ref="mdm_db_Config" fields=",">
			<mongo:query ><![CDATA[#[%dw 2.0
output application/json
var searchTime = p('search-interaction')
---
{
	"Numero_Whatsapp" : vars.numeroWhatsapp,
	"Procesado": false,
	"Fecha_Hora" :  { "\$gt": (now() >> "America/Bogota") - ("PT$(searchTime)M" as Period)}
}]]]></mongo:query>
		</mongo:find-documents>
		<ee:transform doc:name="Transform Message" doc:id="0c46b1bc-0de2-48e9-87d9-8a1500d61cfc" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<async doc:name="Async" doc:id="0bdbf02d-6e3a-47e8-9db7-2ad7aca57f6f">
			<flow-ref doc:name="Call logger after" doc:id="ac240387-993b-4cc8-bb82-438f04fd3183" name="loggin-client-call" />
		</async>
	</sub-flow>
</mule>
