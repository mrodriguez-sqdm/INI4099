<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:mongo="http://www.mulesoft.org/schema/mule/mongo"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/mongo http://www.mulesoft.org/schema/mule/mongo/current/mule-mongo.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="patch-parametersPostes-clientSub_Flow" doc:id="03c89852-9eb7-486b-a953-db24514179c6" >
		<async doc:name="Async" doc:id="06cc834a-d61c-454d-aa2e-d96268b26d15">
			<flow-ref doc:name="Call logger before" doc:id="8dc0c596-5577-42d9-a9fb-1e364971a170" name="loggin-client-call" />
		</async>
		<ee:transform doc:name="Transform Message" doc:id="4c9a185a-f62c-4168-9338-ea6fd0c0ec3c">
			<ee:message>
			</ee:message>
			<ee:variables>
				<ee:set-variable variableName="query"><![CDATA[%dw 2.0
output application/json
---
{"Orden_Activacion.Postes_Instalacion.$(payload.index)" : payload.newParams}]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<mongo:update-documents doc:name="Update parameters" doc:id="71a7a665-a01a-40aa-8de7-d1fb366c6c7c" config-ref="mdm_db_Config" collectionName="${mongoDb-mdm.mayoristas.collection-order}">
			<mongo:query ><![CDATA[#[%dw 2.0
output application/json
---
{ 
	'Numero_Orden': vars.orderNumber,
	'Orden_Activacion.Postes_Instalacion.ID' : vars.idPoste
}]]]></mongo:query>
			<mongo:content-to-update ><![CDATA[#[vars.query]]]></mongo:content-to-update>
		</mongo:update-documents>
		<async doc:name="Async" doc:id="911152eb-876a-4061-9fe3-4ae5a0b1154d" >
			<flow-ref doc:name="Call logger after" doc:id="cc99a59f-d21a-4c7c-9cb7-babaf0a8bbae" name="loggin-client-call" />
		</async>
	</sub-flow>
	<sub-flow name="patch-parametersPostesOrderCompleted-clientSub_Flow" doc:id="9b4bc670-7268-462d-bb6c-b37cc9e1d90d" >
		<async doc:name="Async" doc:id="fdcb1a48-63b3-4f19-a85f-b977e00efdbf">
			<flow-ref doc:name="Call logger before" doc:id="44b8f224-b955-4834-b8ed-032d1eab8823" name="loggin-client-call" />
		</async>
		<ee:transform doc:name="Transform Message" doc:id="5167a4ac-1ca7-4d22-872f-2fa7465537c6">
			<ee:message>
			</ee:message>
			<ee:variables>
				<ee:set-variable variableName="query"><![CDATA[%dw 2.0
output application/json
---
{"Orden_Activacion.Postes_Instalacion.$(payload.index)" : payload.newParams}]]></ee:set-variable>
			</ee:variables>
		</ee:transform>
		<mongo:update-documents doc:name="Update parameters" doc:id="5f0000b2-6f71-4806-8ae7-22f3fe86da44" config-ref="mdm_db_Config" collectionName="${mongoDb-mdm.mayoristas.collection-order-completed}">
			<mongo:query ><![CDATA[#[%dw 2.0
output application/json
---
{ 
	'Numero_Orden': vars.orderNumber,
	'Orden_Activacion.Postes_Instalacion.ID' : vars.idPoste
}]]]></mongo:query>
			<mongo:content-to-update ><![CDATA[#[vars.query]]]></mongo:content-to-update>
		</mongo:update-documents>
		<async doc:name="Async" doc:id="a8977d56-7801-4635-9cf1-15dcf7e109f6" >
			<flow-ref doc:name="Call logger after" doc:id="22ecd187-59f1-42fe-98e6-1163e3a43a36" name="loggin-client-call" />
		</async>
	</sub-flow>
</mule>
