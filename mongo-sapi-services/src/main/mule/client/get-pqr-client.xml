<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:mongo="http://www.mulesoft.org/schema/mule/mongo"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/mongo http://www.mulesoft.org/schema/mule/mongo/current/mule-mongo.xsd
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
	<sub-flow name="get-pqr-clientSub_Flow" doc:id="cd5571c0-c049-4ab6-9da7-46c032762e59" >
		<async doc:name="Async" doc:id="d7830e67-567b-4f74-90d1-9a68e519b1f5" >
			<flow-ref doc:name="Call logger before" doc:id="32a973fe-f021-42e7-86e5-a1c28be92b8c" name="loggin-client-call" />
		</async>
		<mongo:find-documents collectionName="${mongoDb-mdm.pqr.collection}" fields="," doc:name="Find documents PQR" doc:id="dfc7d003-14b0-43d7-bc0a-7020cae57afc" config-ref="mdm_db_Config" >
			<mongo:query ><![CDATA[#[%dw 2.0
output application/json
var cun = attributes.queryParams.cun
var numero_pqr = attributes.queryParams.id
var tipo_documento = attributes.queryParams.tipoIdentificacion
var numero_identificacion = attributes.queryParams.numIdentificacion
---
{
    ("cun": cun) if (cun != null),
    ("numero_pqr": numero_pqr) if (numero_pqr != null),
    ("tipo_documento": tipo_documento) if (tipo_documento != null), 
    ("numero_identificacion": numero_identificacion) if (numero_identificacion != null)
}]]]></mongo:query>
		</mongo:find-documents>
		<async doc:name="Async" doc:id="8912a6d3-c314-4411-8dea-91009fedfdb5" >
			<flow-ref doc:name="Call logger after" doc:id="7caec7b4-a130-45f7-b47f-6748df826c5f" name="loggin-client-call" />
		</async>
	</sub-flow>
	<sub-flow name="get-pqrByCtaFacturacionYSintoma-clientSub_Flow" doc:id="da39ab25-5ca1-48ec-aa68-2974bfeddeec" >
		<async doc:name="Async" doc:id="8986025f-b558-403d-af1c-0688bef3a2c3" >
			<flow-ref doc:name="Call logger before" doc:id="737552e3-c286-4570-885d-b7bda6f1058e" name="audits-mongo-log-before" />
		</async>
		<mongo:find-documents collectionName="${mongoDb-mdm.pqr.collection}" fields="," doc:name="Find documents PQR" doc:id="6108b9a1-ca99-4145-b2b4-434232dedaa0" config-ref="mdm_db_Config" >
			<mongo:query ><![CDATA[#[%dw 2.0
output application/json
var ctaFacturacion = attributes.queryParams.idCuentaFacturacion
---
{
    ("cuenta_facturacion": ctaFacturacion) if (ctaFacturacion != null),
    "sintoma_pqr": p('mongoDb-mdm.pqr.sintoma_mietb')
}]]]></mongo:query>
		</mongo:find-documents>
		<async doc:name="Async" doc:id="4422c1bc-8be2-4897-81a3-ac6f8140aa33" >
			<flow-ref doc:name="Call logger after" doc:id="85ed9457-0e0f-4b28-bf9d-a7840d1e10fe" name="audits-mongo-log-after" />
		</async>
	</sub-flow>
</mule>
